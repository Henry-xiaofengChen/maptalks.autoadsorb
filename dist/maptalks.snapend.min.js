/*!
 * maptalks.snapend v0.1.0
 * LICENSE : MIT
 * (c) 2016-2018 maptalks.org
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],t):t(e.maptalks=e.maptalks||{},e.maptalks)}(this,function(e,i){"use strict";"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function r(e,t){return e(t={exports:{}},t.exports),t.exports}var s=r(function(e,t){e.exports=function(){function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function o(e,t){return e<t?-1:t<e?1:0}return function(e,t,r,n,i){!function e(t,r,n,i,o){for(;n<i;){if(600<i-n){var a=i-n+1,s=r-n+1,u=Math.log(a),l=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*l*(a-l)/a)*(s-a/2<0?-1:1),c=Math.max(n,Math.floor(r-s*l/a+h)),f=Math.min(i,Math.floor(r+(a-s)*l/a+h));e(t,r,c,f,o)}var m=t[r],d=n,p=i;for(g(t,n,r),0<o(t[i],m)&&g(t,n,i);d<p;){for(g(t,d,p),d++,p--;o(t[d],m)<0;)d++;for(;0<o(t[p],m);)p--}0===o(t[n],m)?g(t,n,p):g(t,++p,i),p<=r&&(n=p+1),r<=p&&(i=p-1)}}(e,t,r||0,n||e.length-1,i||o)}}()}),n=a,o=a;function a(e,t){if(!(this instanceof a))return new a(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()}function h(e,t,r){if(!r)return t.indexOf(e);for(var n=0;n<t.length;n++)if(r(e,t[n]))return n;return-1}function m(e,t){y(e,0,e.children.length,t,e)}function y(e,t,r,n,i){i||(i=g(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,a=t;a<r;a++)o=e.children[a],c(i,e.leaf?n(o):o);return i}function c(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function u(e,t){return e.minX-t.minX}function l(e,t){return e.minY-t.minY}function v(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function f(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function g(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function b(e,t,r,n,i){for(var o,a=[t,r];a.length;)(r=a.pop())-(t=a.pop())<=n||(o=t+Math.ceil((r-t)/n/2)*n,s(e,o,t,r,i),a.push(t,o,o,r))}a.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,r=[],n=this.toBBox;if(!p(e,t))return r;for(var i,o,a,s,u=[];t;){for(i=0,o=t.children.length;i<o;i++)a=t.children[i],p(e,s=t.leaf?n(a):a)&&(t.leaf?r.push(a):d(e,s)?this._all(a,r):u.push(a));t=u.pop()}return r},collides:function(e){var t=this.data,r=this.toBBox;if(!p(e,t))return!1;for(var n,i,o,a,s=[];t;){for(n=0,i=t.children.length;n<i;n++)if(o=t.children[n],p(e,a=t.leaf?r(o):o)){if(t.leaf||d(e,a))return!0;s.push(o)}t=s.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=g([]),this},remove:function(e,t){if(!e)return this;for(var r,n,i,o,a=this.data,s=this.toBBox(e),u=[],l=[];a||u.length;){if(a||(a=u.pop(),n=u[u.length-1],r=l.pop(),o=!0),a.leaf&&-1!==(i=h(e,a.children,t)))return a.children.splice(i,1),u.push(a),this._condense(u),this;o||a.leaf||!d(a,s)?n?(r++,a=n.children[r],o=!1):a=null:(u.push(a),l.push(r),r=0,a=(n=a).children[0])}return this},toBBox:function(e){return e},compareMinX:u,compareMinY:l,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var r=[];e;)e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children),e=r.pop();return t},_build:function(e,t,r,n){var i,o=r-t+1,a=this._maxEntries;if(o<=a)return m(i=g(e.slice(t,r+1)),this.toBBox),i;n||(n=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,n-1))),(i=g([])).leaf=!1,i.height=n;var s,u,l,h,c=Math.ceil(o/a),f=c*Math.ceil(Math.sqrt(a));for(b(e,t,r,f,this.compareMinX),s=t;s<=r;s+=f)for(b(e,s,l=Math.min(s+f-1,r),c,this.compareMinY),u=s;u<=l;u+=c)h=Math.min(u+c-1,l),i.children.push(this._build(e,u,h,n-1));return m(i,this.toBBox),i},_chooseSubtree:function(e,t,r,n){for(var i,o,a,s,u,l,h,c,f,m;n.push(t),!t.leaf&&n.length-1!==r;){for(h=c=1/0,i=0,o=t.children.length;i<o;i++)u=v(a=t.children[i]),f=e,m=a,(l=(Math.max(m.maxX,f.maxX)-Math.min(m.minX,f.minX))*(Math.max(m.maxY,f.maxY)-Math.min(m.minY,f.minY))-u)<c?(c=l,h=u<h?u:h,s=a):l===c&&u<h&&(h=u,s=a);t=s||t.children[0]}return t},_insert:function(e,t,r){var n=this.toBBox,i=r?e:n(e),o=[],a=this._chooseSubtree(i,this.data,t,o);for(a.children.push(e),c(a,i);0<=t&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(i,o,t)},_split:function(e,t){var r=e[t],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var o=this._chooseSplitIndex(r,i,n),a=g(r.children.splice(o,r.children.length-o));a.height=r.height,a.leaf=r.leaf,m(r,this.toBBox),m(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(r,a)},_splitRoot:function(e,t){this.data=g([e,t]),this.data.height=e.height+1,this.data.leaf=!1,m(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,r){var n,i,o,a,s,u,l,h,c,f,m,d,p,g;for(u=l=1/0,n=t;n<=r-t;n++)i=y(e,0,n,this.toBBox),o=y(e,n,r,this.toBBox),c=i,f=o,void 0,m=Math.max(c.minX,f.minX),d=Math.max(c.minY,f.minY),p=Math.min(c.maxX,f.maxX),g=Math.min(c.maxY,f.maxY),a=Math.max(0,p-m)*Math.max(0,g-d),s=v(i)+v(o),a<u?(u=a,h=n,l=s<l?s:l):a===u&&s<l&&(l=s,h=n);return h},_chooseSplitAxis:function(e,t,r){var n=e.leaf?this.compareMinX:u,i=e.leaf?this.compareMinY:l;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,i)&&e.children.sort(n)},_allDistMargin:function(e,t,r,n){e.children.sort(n);var i,o,a=this.toBBox,s=y(e,0,t,a),u=y(e,r-t,r,a),l=f(s)+f(u);for(i=t;i<r-t;i++)o=e.children[i],c(s,e.leaf?a(o):o),l+=f(s);for(i=r-t-1;t<=i;i--)o=e.children[i],c(u,e.leaf?a(o):o),l+=f(u);return l},_adjustParentBBoxes:function(e,t,r){for(var n=r;0<=n;n--)c(t[n],e)},_condense:function(e){for(var t,r=e.length-1;0<=r;r--)0===e[r].children.length?0<r?(t=e[r-1].children).splice(t.indexOf(e[r]),1):this.clear():m(e[r],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}},n.default=o;var x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w=r(function(e,o){function s(e,t,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function n(e,t,r){return void 0===r&&(r={}),s({type:"Point",coordinates:e},t,r)}function i(e,t,r){void 0===r&&(r={});for(var n=0,i=e;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return s({type:"Polygon",coordinates:e},t,r)}function a(e,t,r){if(void 0===r&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return s({type:"LineString",coordinates:e},t,r)}function u(e,t){void 0===t&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function l(e,t,r){return void 0===r&&(r={}),s({type:"MultiLineString",coordinates:e},t,r)}function h(e,t,r){return void 0===r&&(r={}),s({type:"MultiPoint",coordinates:e},t,r)}function c(e,t,r){return void 0===r&&(r={}),s({type:"MultiPolygon",coordinates:e},t,r)}function f(e,t){void 0===t&&(t="kilometers");var r=o.factors[t];if(!r)throw new Error(t+" units is invalid");return e*r}function m(e,t){void 0===t&&(t="kilometers");var r=o.factors[t];if(!r)throw new Error(t+" units is invalid");return e/r}function r(e){return 180*(e%(2*Math.PI))/Math.PI}function t(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)&&!/^\s*$/.test(e)}Object.defineProperty(o,"__esModule",{value:!0}),o.earthRadius=6371008.8,o.factors={centimeters:100*o.earthRadius,centimetres:100*o.earthRadius,degrees:o.earthRadius/111325,feet:3.28084*o.earthRadius,inches:39.37*o.earthRadius,kilometers:o.earthRadius/1e3,kilometres:o.earthRadius/1e3,meters:o.earthRadius,metres:o.earthRadius,miles:o.earthRadius/1609.344,millimeters:1e3*o.earthRadius,millimetres:1e3*o.earthRadius,nauticalmiles:o.earthRadius/1852,radians:1,yards:o.earthRadius/1.0936},o.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/o.earthRadius,yards:1/1.0936},o.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},o.feature=s,o.geometry=function(e,t,r){switch(void 0===r&&(r={}),e){case"Point":return n(t).geometry;case"LineString":return a(t).geometry;case"Polygon":return i(t).geometry;case"MultiPoint":return h(t).geometry;case"MultiLineString":return l(t).geometry;case"MultiPolygon":return c(t).geometry;default:throw new Error(e+" is invalid")}},o.point=n,o.points=function(e,t,r){return void 0===r&&(r={}),u(e.map(function(e){return n(e,t)}),r)},o.polygon=i,o.polygons=function(e,t,r){return void 0===r&&(r={}),u(e.map(function(e){return i(e,t)}),r)},o.lineString=a,o.lineStrings=function(e,t,r){return void 0===r&&(r={}),u(e.map(function(e){return a(e,t)}),r)},o.featureCollection=u,o.multiLineString=l,o.multiPoint=h,o.multiPolygon=c,o.geometryCollection=function(e,t,r){return void 0===r&&(r={}),s({type:"GeometryCollection",geometries:e},t,r)},o.round=function(e,t){if(void 0===t&&(t=0),t&&!(0<=t))throw new Error("precision must be a positive number");var r=Math.pow(10,t||0);return Math.round(e*r)/r},o.radiansToLength=f,o.lengthToRadians=m,o.lengthToDegrees=function(e,t){return r(m(e,t))},o.bearingToAzimuth=function(e){var t=e%360;return t<0&&(t+=360),t},o.radiansToDegrees=r,o.degreesToRadians=function(e){return e%360*Math.PI/180},o.convertLength=function(e,t,r){if(void 0===t&&(t="kilometers"),void 0===r&&(r="kilometers"),!(0<=e))throw new Error("length must be a positive number");return f(m(e,t),r)},o.convertArea=function(e,t,r){if(void 0===t&&(t="meters"),void 0===r&&(r="kilometers"),!(0<=e))throw new Error("area must be a positive number");var n=o.areaFactors[t];if(!n)throw new Error("invalid original units");var i=o.areaFactors[r];if(!i)throw new Error("invalid final units");return e/n*i},o.isNumber=t,o.isObject=function(e){return!!e&&e.constructor===Object},o.validateBBox=function(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(e){if(!t(e))throw new Error("bbox must only contain numbers")})},o.validateId=function(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(void 0===e?"undefined":x(e)))throw new Error("id must be a number or a string")},o.radians2degrees=function(){throw new Error("method has been renamed to `radiansToDegrees`")},o.degrees2radians=function(){throw new Error("method has been renamed to `degreesToRadians`")},o.distanceToDegrees=function(){throw new Error("method has been renamed to `lengthToDegrees`")},o.distanceToRadians=function(){throw new Error("method has been renamed to `lengthToRadians`")},o.radiansToDistance=function(){throw new Error("method has been renamed to `radiansToLength`")},o.bearingToAngle=function(){throw new Error("method has been renamed to `bearingToAzimuth`")},o.convertDistance=function(){throw new Error("method has been renamed to `convertLength`")}});t(w);var _=r(function(e,t){function _(e,t,r){if(null!==e)for(var n,i,o,a,s,u,l,h,c=0,f=0,m=e.type,d="FeatureCollection"===m,p="Feature"===m,g=d?e.features.length:1,y=0;y<g;y++){s=(h=!!(l=d?e.features[y].geometry:p?e.geometry:e)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var v=0;v<s;v++){var b=0,x=0;if(null!==(a=h?l.geometries[v]:l)){u=a.coordinates;var w=a.type;switch(c=!r||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===t(u,f,y,b,x))return!1;f++,b++;break;case"LineString":case"MultiPoint":for(n=0;n<u.length;n++){if(!1===t(u[n],f,y,b,x))return!1;f++,"MultiPoint"===w&&b++}"LineString"===w&&b++;break;case"Polygon":case"MultiLineString":for(n=0;n<u.length;n++){for(i=0;i<u[n].length-c;i++){if(!1===t(u[n][i],f,y,b,x))return!1;f++}"MultiLineString"===w&&b++,"Polygon"===w&&x++}"Polygon"===w&&b++;break;case"MultiPolygon":for(n=0;n<u.length;n++){for(i=x=0;i<u[n].length;i++){for(o=0;o<u[n][i].length-c;o++){if(!1===t(u[n][i][o],f,y,b,x))return!1;f++}x++}b++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(!1===_(a.geometries[n],t,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function o(e,t){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&!1!==t(e.features[r].properties,r);r++);break;case"Feature":t(e.properties,0)}}function a(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var r=0;r<e.features.length&&!1!==t(e.features[r],r);r++);}function r(e,t){var r,n,i,o,a,s,u,l,h,c,f=0,m="FeatureCollection"===e.type,d="Feature"===e.type,p=m?e.features.length:1;for(r=0;r<p;r++){for(s=m?e.features[r].geometry:d?e.geometry:e,l=m?e.features[r].properties:d?e.properties:{},h=m?e.features[r].bbox:d?e.bbox:void 0,c=m?e.features[r].id:d?e.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,f,l,h,c))return!1;break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===t(o.geometries[n],f,l,h,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,f,l,h,c))return!1;f++}}function s(e,l){r(e,function(e,t,r,n,i){var o,a=null===e?null:e.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==l(w.feature(e,r,{bbox:n,id:i}),t,0)&&void 0}switch(a){case"MultiPoint":o="Point";break;case"MultiLineString":o="LineString";break;case"MultiPolygon":o="Polygon"}for(var s=0;s<e.coordinates.length;s++){var u={type:o,coordinates:e.coordinates[s]};if(!1===l(w.feature(u,r),t,s))return!1}})}function n(e,d){s(e,function(a,s,u){var l=0;if(a.geometry){var e=a.geometry.type;if("Point"!==e&&"MultiPoint"!==e){var h,c=0,f=0,m=0;return!1!==_(a,function(e,t,r,n,i){if(void 0===h||c<s||f<n||m<i)return h=e,c=s,f=n,m=i,void(l=0);var o=w.lineString([h,e],a.properties);if(!1===d(o,s,u,i,l))return!1;l++,h=e})&&void 0}}})}function u(e,a){if(!e)throw new Error("geojson is required");s(e,function(e,t,r){if(null!==e.geometry){var n=e.geometry.type,i=e.geometry.coordinates;switch(n){case"LineString":if(!1===a(e,t,r,0,0))return!1;break;case"Polygon":for(var o=0;o<i.length;o++)if(!1===a(w.lineString(i[o],e.properties),t,r,o))return!1}}})}Object.defineProperty(t,"__esModule",{value:!0}),t.coordEach=_,t.coordReduce=function(e,o,a,t){var s=a;return _(e,function(e,t,r,n,i){s=0===t&&void 0===a?e:o(s,e,t,r,n,i)},t),s},t.propEach=o,t.propReduce=function(e,r,n){var i=n;return o(e,function(e,t){i=0===t&&void 0===n?e:r(i,e,t)}),i},t.featureEach=a,t.featureReduce=function(e,r,n){var i=n;return a(e,function(e,t){i=0===t&&void 0===n?e:r(i,e,t)}),i},t.coordAll=function(e){var t=[];return _(e,function(e){t.push(e)}),t},t.geomEach=r,t.geomReduce=function(e,o,a){var s=a;return r(e,function(e,t,r,n,i){s=0===t&&void 0===a?e:o(s,e,t,r,n,i)}),s},t.flattenEach=s,t.flattenReduce=function(e,n,i){var o=i;return s(e,function(e,t,r){o=0===t&&0===r&&void 0===i?e:n(o,e,t,r)}),o},t.segmentEach=n,t.segmentReduce=function(e,o,a){var s=a,u=!1;return n(e,function(e,t,r,n,i){s=!1===u&&void 0===a?e:o(s,e,t,r,n,i),u=!0}),s},t.lineEach=u,t.lineReduce=function(e,i,o){var a=o;return u(e,function(e,t,r,n){a=0===t&&void 0===o?e:i(a,e,t,r,n)}),a},t.findSegment=function(e,t){if(t=t||{},!w.isObject(t))throw new Error("options is invalid");var r,n=t.featureIndex||0,i=t.multiFeatureIndex||0,o=t.geometryIndex||0,a=t.segmentIndex||0,s=t.properties;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),s=s||e.features[n].properties,r=e.features[n].geometry;break;case"Feature":s=s||e.properties,r=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=e;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=u.length+a-1),w.lineString([u[a],u[a+1]],s,t);case"Polygon":return o<0&&(o=u.length+o),a<0&&(a=u[o].length+a-1),w.lineString([u[o][a],u[o][a+1]],s,t);case"MultiLineString":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a-1),w.lineString([u[i][a],u[i][a+1]],s,t);case"MultiPolygon":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o),a<0&&(a=u[i][o].length-a-1),w.lineString([u[i][o][a],u[i][o][a+1]],s,t)}throw new Error("geojson is invalid")},t.findPoint=function(e,t){if(t=t||{},!w.isObject(t))throw new Error("options is invalid");var r,n=t.featureIndex||0,i=t.multiFeatureIndex||0,o=t.geometryIndex||0,a=t.coordIndex||0,s=t.properties;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),s=s||e.features[n].properties,r=e.features[n].geometry;break;case"Feature":s=s||e.properties,r=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=e;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":return w.point(u,s,t);case"MultiPoint":return i<0&&(i=u.length+i),w.point(u[i],s,t);case"LineString":return a<0&&(a=u.length+a),w.point(u[a],s,t);case"Polygon":return o<0&&(o=u.length+o),a<0&&(a=u[o].length+a),w.point(u[o][a],s,t);case"MultiLineString":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a),w.point(u[i][a],s,t);case"MultiPolygon":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o),a<0&&(a=u[i][o].length-a),w.point(u[i][o][a],s,t)}throw new Error("geojson is invalid")}});t(_);var M=r(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=[1/0,1/0,-1/0,-1/0];return _.coordEach(e,function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])}),t}});t(M);var P=M.default,E=_.featureEach,S=w.featureCollection;function B(e){var t=n(e);return t.insert=function(e){if("Feature"!==e.type)throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:P(e),n.prototype.insert.call(this,e)},t.load=function(e){var t=[];return Array.isArray(e)?e.forEach(function(e){if("Feature"!==e.type)throw new Error("invalid features");e.bbox=e.bbox?e.bbox:P(e),t.push(e)}):E(e,function(e){if("Feature"!==e.type)throw new Error("invalid features");e.bbox=e.bbox?e.bbox:P(e),t.push(e)}),n.prototype.load.call(this,t)},t.remove=function(e,t){if("Feature"!==e.type)throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:P(e),n.prototype.remove.call(this,e,t)},t.clear=function(){return n.prototype.clear.call(this)},t.search=function(e){var t=n.prototype.search.call(this,this.toBBox(e));return S(t)},t.collides=function(e){return n.prototype.collides.call(this,this.toBBox(e))},t.all=function(){var e=n.prototype.all.call(this);return S(e)},t.toJSON=function(){return n.prototype.toJSON.call(this)},t.fromJSON=function(e){return n.prototype.fromJSON.call(this,e)},t.toBBox=function(e){var t;if(e.bbox)t=e.bbox;else if(Array.isArray(e)&&4===e.length)t=e;else if(Array.isArray(e)&&6===e.length)t=[e[0],e[1],e[3],e[4]];else if("Feature"===e.type)t=P(e);else{if("FeatureCollection"!==e.type)throw new Error("invalid geojson");t=P(e)}return{minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}},t}var X=B,Y=B;function k(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):function(e,t){for(var r=Object.getOwnPropertyNames(t),n=0;n<r.length;n++){var i=r[n],o=Object.getOwnPropertyDescriptor(t,i);o&&o.configurable&&void 0===e[i]&&Object.defineProperty(e,i,o)}}(e,t))}X.default=Y;var F=function(r){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,r.call(this,e));return t.tree=X(),t}return k(n,r),n.prototype.addTo=function(e){var t=i.INTERNAL_LAYER_PREFIX+"_snapendpoint";return this._mousemoveLayer=new i.VectorLayer(t).addTo(e),this._map=e,this._resetGeosSet(),this.enable(),this},n.prototype.enable=function(){var e=this._map;return this.snaplayer&&this._compositGeometries(),this._geosSet&&(this._registerEvents(e),this._mousemoveLayer.show()),this},n.prototype.disable=function(){var e=this._map;return e.off("mousemove touchstart",this._mousemove),e.off("mousedown",this._mousedown,this),e.off("mouseup",this._mouseup,this),delete this._mousemove,delete this._mousedown,delete this._mouseup,this._mousemoveLayer.hide(),this._resetGeosSet(),this},n.prototype.setLayer=function(e){var t=this;return e instanceof i.VectorLayer&&(this.snaplayer=e,this._compositGeometries(),this.snaplayer.on("addgeo",function(){return t._compositGeometries()},this),this.snaplayer.on("clear",function(){return t._resetGeosSet()},this),this._mousemoveLayer.bringToFront()),this},n.prototype.bindDrawTool=function(e){var t=this;return e instanceof i.DrawTool&&(e.on("drawstart",function(e){return t._resetCoordsAndPoint(e)},this),e.on("mousemove",function(e){return t._resetCoordinates(e.target._geometry)},this),e.on("drawvertex",function(e){return t._resetCoordsAndPoint(e)},this),e.on("drawend",function(e){return t._resetCoordinates(e.geometry)},this)),this},n.prototype._resetCoordsAndPoint=function(e){this._resetCoordinates(e.target._geometry),this._resetClickPoint(e.target._clickCoords)},n.prototype._resetCoordinates=function(e){this.snapPoint},n.prototype._resetClickPoint=function(e){if(this.snapPoint){var t=this.snapPoint,r=t.x,n=t.y,i=e.length;e[i-1].x=r,e[i-1].y=n}},n.prototype._registerEvents=function(){var t=this;if(!this._mousemove){var e=this._map;this._needFindGeometry=!0,this._mousemove=function(e){return t._mousemoveEvents(e)},this._mousedown=function(){return t._needFindGeometry=!1},this._mouseup=function(){return t._needFindGeometry=!0},e.on("mousemove touchstart",this._mousemove,this),e.on("mousedown",this._mousedown,this),e.on("mouseup",this._mouseup,this)}},n.prototype._mousemoveEvents=function(e){console.log(e)},n.prototype._compositGeometries=function(){this.snaplayer.getGeometries();this._geosSet=[]},n.prototype._resetGeosSet=function(){this._geosSet=[]},n}(i.Class);F.mergeOptions({}),e.SnapEndPoint=F,Object.defineProperty(e,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.snapend v0.1.0")});