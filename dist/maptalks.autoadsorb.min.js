/*!
 * maptalks.autoadsorb v0.1.0
 * LICENSE : MIT
 * (c) 2016-2019 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,d){"use strict";var ve="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function r(t,e){return t(e={exports:{}},e.exports),e.exports}var s=r(function(t,e){t.exports=function(){function v(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function i(t,e){return t<e?-1:e<t?1:0}return function(t,e,r,n,o){!function t(e,r,n,o,i){for(;n<o;){if(600<o-n){var a=o-n+1,s=r-n+1,u=Math.log(a),c=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*c*(a-c)/a)*(s-a/2<0?-1:1),l=Math.max(n,Math.floor(r-s*c/a+f)),h=Math.min(o,Math.floor(r+(a-s)*c/a+f));t(e,r,l,h,i)}var p=e[r],d=n,y=o;for(v(e,n,r),0<i(e[o],p)&&v(e,n,o);d<y;){for(v(e,d,y),d++,y--;i(e[d],p)<0;)d++;for(;0<i(e[y],p);)y--}0===i(e[n],p)?v(e,n,y):v(e,++y,o),y<=r&&(n=y+1),r<=y&&(o=y-1)}}(t,e,r||0,n||t.length-1,o||i)}}()}),n=i,o=i;function i(t,e){if(!(this instanceof i))return new i(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function f(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}function p(t,e){_(t,0,t.children.length,e,t)}function _(t,e,r,n,o){o||(o=v(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(var i,a=e;a<r;a++)i=t.children[a],l(o,t.leaf?n(i):i);return o}function l(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function a(t,e){return t.minX-e.minX}function u(t,e){return t.minY-e.minY}function m(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function h(t){return t.maxX-t.minX+(t.maxY-t.minY)}function y(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function c(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function v(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(t,e,r,n,o){for(var i,a=[e,r];a.length;)(r=a.pop())-(e=a.pop())<=n||(i=e+Math.ceil((r-e)/n/2)*n,s(t,i,e,r,o),a.push(e,i,i,r))}i.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],n=this.toBBox;if(!c(t,e))return r;for(var o,i,a,s,u=[];e;){for(o=0,i=e.children.length;o<i;o++)a=e.children[o],c(t,s=e.leaf?n(a):a)&&(e.leaf?r.push(a):y(t,s)?this._all(a,r):u.push(a));e=u.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!c(t,e))return!1;for(var n,o,i,a,s=[];e;){for(n=0,o=e.children.length;n<o;n++)if(i=e.children[n],c(t,a=e.leaf?r(i):i)){if(e.leaf||y(t,a))return!0;s.push(i)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var o=this.data;this.data=n,n=o}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=v([]),this},remove:function(t,e){if(!t)return this;for(var r,n,o,i,a=this.data,s=this.toBBox(t),u=[],c=[];a||u.length;){if(a||(a=u.pop(),n=u[u.length-1],r=c.pop(),i=!0),a.leaf&&-1!==(o=f(t,a.children,e)))return a.children.splice(o,1),u.push(a),this._condense(u),this;i||a.leaf||!y(a,s)?n?(r++,a=n.children[r],i=!1):a=null:(u.push(a),c.push(r),r=0,a=(n=a).children[0])}return this},toBBox:function(t){return t},compareMinX:a,compareMinY:u,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,n){var o,i=r-e+1,a=this._maxEntries;if(i<=a)return p(o=v(t.slice(e,r+1)),this.toBBox),o;n||(n=Math.ceil(Math.log(i)/Math.log(a)),a=Math.ceil(i/Math.pow(a,n-1))),(o=v([])).leaf=!1,o.height=n;var s,u,c,f,l=Math.ceil(i/a),h=l*Math.ceil(Math.sqrt(a));for(g(t,e,r,h,this.compareMinX),s=e;s<=r;s+=h)for(g(t,s,c=Math.min(s+h-1,r),l,this.compareMinY),u=s;u<=c;u+=l)f=Math.min(u+l-1,c),o.children.push(this._build(t,u,f,n-1));return p(o,this.toBBox),o},_chooseSubtree:function(t,e,r,n){for(var o,i,a,s,u,c,f,l,h,p;n.push(e),!e.leaf&&n.length-1!==r;){for(f=l=1/0,o=0,i=e.children.length;o<i;o++)u=m(a=e.children[o]),h=t,p=a,(c=(Math.max(p.maxX,h.maxX)-Math.min(p.minX,h.minX))*(Math.max(p.maxY,h.maxY)-Math.min(p.minY,h.minY))-u)<l?(l=c,f=u<f?u:f,s=a):c===l&&u<f&&(f=u,s=a);e=s||e.children[0]}return e},_insert:function(t,e,r){var n=this.toBBox,o=r?t:n(t),i=[],a=this._chooseSubtree(o,this.data,e,i);for(a.children.push(t),l(a,o);0<=e&&i[e].children.length>this._maxEntries;)this._split(i,e),e--;this._adjustParentBBoxes(o,i,e)},_split:function(t,e){var r=t[e],n=r.children.length,o=this._minEntries;this._chooseSplitAxis(r,o,n);var i=this._chooseSplitIndex(r,o,n),a=v(r.children.splice(i,r.children.length-i));a.height=r.height,a.leaf=r.leaf,p(r,this.toBBox),p(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(r,a)},_splitRoot:function(t,e){this.data=v([t,e]),this.data.height=t.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var n,o,i,a,s,u,c,f,l,h,p,d,y,v;for(u=c=1/0,n=e;n<=r-e;n++)o=_(t,0,n,this.toBBox),i=_(t,n,r,this.toBBox),l=o,h=i,void 0,p=Math.max(l.minX,h.minX),d=Math.max(l.minY,h.minY),y=Math.min(l.maxX,h.maxX),v=Math.min(l.maxY,h.maxY),a=Math.max(0,y-p)*Math.max(0,v-d),s=m(o)+m(i),a<u?(u=a,f=n,c=s<c?s:c):a===u&&s<c&&(c=s,f=n);return f},_chooseSplitAxis:function(t,e,r){var n=t.leaf?this.compareMinX:a,o=t.leaf?this.compareMinY:u;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,o)&&t.children.sort(n)},_allDistMargin:function(t,e,r,n){t.children.sort(n);var o,i,a=this.toBBox,s=_(t,0,e,a),u=_(t,r-e,r,a),c=h(s)+h(u);for(o=e;o<r-e;o++)i=t.children[o],l(s,t.leaf?a(i):i),c+=h(s);for(o=r-e-1;e<=o;o--)i=t.children[o],l(u,t.leaf?a(i):i),c+=h(u);return c},_adjustParentBBoxes:function(t,e,r){for(var n=r;0<=n;n--)l(e[n],t)},_condense:function(t){for(var e,r=t.length-1;0<=r;r--)0===t[r].children.length?0<r?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():p(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}},n.default=o;var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w=r(function(t,i){function s(t,e,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function n(t,e,r){return void 0===r&&(r={}),s({type:"Point",coordinates:t},e,r)}function o(t,e,r){void 0===r&&(r={});for(var n=0,o=t;n<o.length;n++){var i=o[n];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<i[i.length-1].length;a++)if(i[i.length-1][a]!==i[0][a])throw new Error("First and last Position are not equivalent.")}return s({type:"Polygon",coordinates:t},e,r)}function a(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return s({type:"LineString",coordinates:t},e,r)}function u(t,e){void 0===e&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function c(t,e,r){return void 0===r&&(r={}),s({type:"MultiLineString",coordinates:t},e,r)}function f(t,e,r){return void 0===r&&(r={}),s({type:"MultiPoint",coordinates:t},e,r)}function l(t,e,r){return void 0===r&&(r={}),s({type:"MultiPolygon",coordinates:t},e,r)}function h(t,e){void 0===e&&(e="kilometers");var r=i.factors[e];if(!r)throw new Error(e+" units is invalid");return t*r}function p(t,e){void 0===e&&(e="kilometers");var r=i.factors[e];if(!r)throw new Error(e+" units is invalid");return t/r}function r(t){return 180*(t%(2*Math.PI))/Math.PI}function e(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)&&!/^\s*$/.test(t)}Object.defineProperty(i,"__esModule",{value:!0}),i.earthRadius=6371008.8,i.factors={centimeters:100*i.earthRadius,centimetres:100*i.earthRadius,degrees:i.earthRadius/111325,feet:3.28084*i.earthRadius,inches:39.37*i.earthRadius,kilometers:i.earthRadius/1e3,kilometres:i.earthRadius/1e3,meters:i.earthRadius,metres:i.earthRadius,miles:i.earthRadius/1609.344,millimeters:1e3*i.earthRadius,millimetres:1e3*i.earthRadius,nauticalmiles:i.earthRadius/1852,radians:1,yards:i.earthRadius/1.0936},i.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/i.earthRadius,yards:1/1.0936},i.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},i.feature=s,i.geometry=function(t,e,r){switch(void 0===r&&(r={}),t){case"Point":return n(e).geometry;case"LineString":return a(e).geometry;case"Polygon":return o(e).geometry;case"MultiPoint":return f(e).geometry;case"MultiLineString":return c(e).geometry;case"MultiPolygon":return l(e).geometry;default:throw new Error(t+" is invalid")}},i.point=n,i.points=function(t,e,r){return void 0===r&&(r={}),u(t.map(function(t){return n(t,e)}),r)},i.polygon=o,i.polygons=function(t,e,r){return void 0===r&&(r={}),u(t.map(function(t){return o(t,e)}),r)},i.lineString=a,i.lineStrings=function(t,e,r){return void 0===r&&(r={}),u(t.map(function(t){return a(t,e)}),r)},i.featureCollection=u,i.multiLineString=c,i.multiPoint=f,i.multiPolygon=l,i.geometryCollection=function(t,e,r){return void 0===r&&(r={}),s({type:"GeometryCollection",geometries:t},e,r)},i.round=function(t,e){if(void 0===e&&(e=0),e&&!(0<=e))throw new Error("precision must be a positive number");var r=Math.pow(10,e||0);return Math.round(t*r)/r},i.radiansToLength=h,i.lengthToRadians=p,i.lengthToDegrees=function(t,e){return r(p(t,e))},i.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},i.radiansToDegrees=r,i.degreesToRadians=function(t){return t%360*Math.PI/180},i.convertLength=function(t,e,r){if(void 0===e&&(e="kilometers"),void 0===r&&(r="kilometers"),!(0<=t))throw new Error("length must be a positive number");return h(p(t,e),r)},i.convertArea=function(t,e,r){if(void 0===e&&(e="meters"),void 0===r&&(r="kilometers"),!(0<=t))throw new Error("area must be a positive number");var n=i.areaFactors[e];if(!n)throw new Error("invalid original units");var o=i.areaFactors[r];if(!o)throw new Error("invalid final units");return t/n*o},i.isNumber=e,i.isObject=function(t){return!!t&&t.constructor===Object},i.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(t){if(!e(t))throw new Error("bbox must only contain numbers")})},i.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(void 0===t?"undefined":b(t)))throw new Error("id must be a number or a string")},i.radians2degrees=function(){throw new Error("method has been renamed to `radiansToDegrees`")},i.degrees2radians=function(){throw new Error("method has been renamed to `degreesToRadians`")},i.distanceToDegrees=function(){throw new Error("method has been renamed to `lengthToDegrees`")},i.distanceToRadians=function(){throw new Error("method has been renamed to `lengthToRadians`")},i.radiansToDistance=function(){throw new Error("method has been renamed to `radiansToLength`")},i.bearingToAngle=function(){throw new Error("method has been renamed to `bearingToAzimuth`")},i.convertDistance=function(){throw new Error("method has been renamed to `convertLength`")}});e(w);var x=r(function(t,e){function x(t,e,r){if(null!==t)for(var n,o,i,a,s,u,c,f,l=0,h=0,p=t.type,d="FeatureCollection"===p,y="Feature"===p,v=d?t.features.length:1,_=0;_<v;_++){s=(f=!!(c=d?t.features[_].geometry:y?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var m=0;m<s;m++){var g=0,b=0;if(null!==(a=f?c.geometries[m]:c)){u=a.coordinates;var w=a.type;switch(l=!r||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===e(u,h,_,g,b))return!1;h++,g++;break;case"LineString":case"MultiPoint":for(n=0;n<u.length;n++){if(!1===e(u[n],h,_,g,b))return!1;h++,"MultiPoint"===w&&g++}"LineString"===w&&g++;break;case"Polygon":case"MultiLineString":for(n=0;n<u.length;n++){for(o=0;o<u[n].length-l;o++){if(!1===e(u[n][o],h,_,g,b))return!1;h++}"MultiLineString"===w&&g++,"Polygon"===w&&b++}"Polygon"===w&&g++;break;case"MultiPolygon":for(n=0;n<u.length;n++){for(o=b=0;o<u[n].length;o++){for(i=0;i<u[n][o].length-l;i++){if(!1===e(u[n][o][i],h,_,g,b))return!1;h++}b++}g++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(!1===x(a.geometries[n],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function i(t,e){var r;switch(t.type){case"FeatureCollection":for(r=0;r<t.features.length&&!1!==e(t.features[r].properties,r);r++);break;case"Feature":e(t.properties,0)}}function a(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}function r(t,e){var r,n,o,i,a,s,u,c,f,l,h=0,p="FeatureCollection"===t.type,d="Feature"===t.type,y=p?t.features.length:1;for(r=0;r<y;r++){for(s=p?t.features[r].geometry:d?t.geometry:t,c=p?t.features[r].properties:d?t.properties:{},f=p?t.features[r].bbox:d?t.bbox:void 0,l=p?t.features[r].id:d?t.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,o=0;o<a;o++)if(null!==(i=u?s.geometries[o]:s))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(i,h,c,f,l))return!1;break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(!1===e(i.geometries[n],h,c,f,l))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,h,c,f,l))return!1;h++}}function s(t,c){r(t,function(t,e,r,n,o){var i,a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==c(w.feature(t,r,{bbox:n,id:o}),e,0)&&void 0}switch(a){case"MultiPoint":i="Point";break;case"MultiLineString":i="LineString";break;case"MultiPolygon":i="Polygon"}for(var s=0;s<t.coordinates.length;s++){var u={type:i,coordinates:t.coordinates[s]};if(!1===c(w.feature(u,r),e,s))return!1}})}function n(t,d){s(t,function(a,s,u){var c=0;if(a.geometry){var t=a.geometry.type;if("Point"!==t&&"MultiPoint"!==t){var f,l=0,h=0,p=0;return!1!==x(a,function(t,e,r,n,o){if(void 0===f||l<s||h<n||p<o)return f=t,l=s,h=n,p=o,void(c=0);var i=w.lineString([f,t],a.properties);if(!1===d(i,s,u,o,c))return!1;c++,f=t})&&void 0}}})}function u(t,a){if(!t)throw new Error("geojson is required");s(t,function(t,e,r){if(null!==t.geometry){var n=t.geometry.type,o=t.geometry.coordinates;switch(n){case"LineString":if(!1===a(t,e,r,0,0))return!1;break;case"Polygon":for(var i=0;i<o.length;i++)if(!1===a(w.lineString(o[i],t.properties),e,r,i))return!1}}})}Object.defineProperty(e,"__esModule",{value:!0}),e.coordEach=x,e.coordReduce=function(t,i,a,e){var s=a;return x(t,function(t,e,r,n,o){s=0===e&&void 0===a?t:i(s,t,e,r,n,o)},e),s},e.propEach=i,e.propReduce=function(t,r,n){var o=n;return i(t,function(t,e){o=0===e&&void 0===n?t:r(o,t,e)}),o},e.featureEach=a,e.featureReduce=function(t,r,n){var o=n;return a(t,function(t,e){o=0===e&&void 0===n?t:r(o,t,e)}),o},e.coordAll=function(t){var e=[];return x(t,function(t){e.push(t)}),e},e.geomEach=r,e.geomReduce=function(t,i,a){var s=a;return r(t,function(t,e,r,n,o){s=0===e&&void 0===a?t:i(s,t,e,r,n,o)}),s},e.flattenEach=s,e.flattenReduce=function(t,n,o){var i=o;return s(t,function(t,e,r){i=0===e&&0===r&&void 0===o?t:n(i,t,e,r)}),i},e.segmentEach=n,e.segmentReduce=function(t,i,a){var s=a,u=!1;return n(t,function(t,e,r,n,o){s=!1===u&&void 0===a?t:i(s,t,e,r,n,o),u=!0}),s},e.lineEach=u,e.lineReduce=function(t,o,i){var a=i;return u(t,function(t,e,r,n){a=0===e&&void 0===i?t:o(a,t,e,r,n)}),a},e.findSegment=function(t,e){if(e=e||{},!w.isObject(e))throw new Error("options is invalid");var r,n=e.featureIndex||0,o=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.segmentIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),s=s||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":s=s||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=u.length+a-1),w.lineString([u[a],u[a+1]],s,e);case"Polygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a-1),w.lineString([u[i][a],u[i][a+1]],s,e);case"MultiLineString":return o<0&&(o=u.length+o),a<0&&(a=u[o].length+a-1),w.lineString([u[o][a],u[o][a+1]],s,e);case"MultiPolygon":return o<0&&(o=u.length+o),i<0&&(i=u[o].length+i),a<0&&(a=u[o][i].length-a-1),w.lineString([u[o][i][a],u[o][i][a+1]],s,e)}throw new Error("geojson is invalid")},e.findPoint=function(t,e){if(e=e||{},!w.isObject(e))throw new Error("options is invalid");var r,n=e.featureIndex||0,o=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.coordIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),s=s||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":s=s||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":return w.point(u,s,e);case"MultiPoint":return o<0&&(o=u.length+o),w.point(u[o],s,e);case"LineString":return a<0&&(a=u.length+a),w.point(u[a],s,e);case"Polygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a),w.point(u[i][a],s,e);case"MultiLineString":return o<0&&(o=u.length+o),a<0&&(a=u[o].length+a),w.point(u[o][a],s,e);case"MultiPolygon":return o<0&&(o=u.length+o),i<0&&(i=u[o].length+i),a<0&&(a=u[o][i].length-a),w.point(u[o][i][a],s,e)}throw new Error("geojson is invalid")}});e(x);var j=r(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=[1/0,1/0,-1/0,-1/0];return x.coordEach(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}});e(j);var S=j.default,P=x.featureEach,E=w.featureCollection;function M(t){var e=n(t);return e.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:S(t),n.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:S(t),e.push(t)}):P(t,function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:S(t),e.push(t)}),n.prototype.load.call(this,e)},e.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:S(t),n.prototype.remove.call(this,t,e)},e.clear=function(){return n.prototype.clear.call(this)},e.search=function(t){var e=n.prototype.search.call(this,this.toBBox(t));return E(e)},e.collides=function(t){return n.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=n.prototype.all.call(this);return E(t)},e.toJSON=function(){return n.prototype.toJSON.call(this)},e.fromJSON=function(t){return n.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=S(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=S(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}var A=M,O=M;A.default=O;var te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C=r(function(t,e){var n="__lodash_hash_undefined__",b=1,_=2,r=9007199254740991,m="[object Arguments]",g="[object Array]",o="[object AsyncFunction]",w="[object Boolean]",x="[object Date]",j="[object Error]",i="[object Function]",a="[object GeneratorFunction]",S="[object Map]",P="[object Number]",s="[object Null]",E="[object Object]",u="[object Promise]",c="[object Proxy]",M="[object RegExp]",A="[object Set]",O="[object String]",C="[object Symbol]",f="[object Undefined]",l="[object WeakMap]",L="[object ArrayBuffer]",k="[object DataView]",h=/^\[object .+?Constructor\]$/,p=/^(?:0|[1-9]\d*)$/,d={};d["[object Float32Array]"]=d["[object Float64Array]"]=d["[object Int8Array]"]=d["[object Int16Array]"]=d["[object Int32Array]"]=d["[object Uint8Array]"]=d["[object Uint8ClampedArray]"]=d["[object Uint16Array]"]=d["[object Uint32Array]"]=!0,d[m]=d[g]=d[L]=d[w]=d[k]=d[x]=d[j]=d[i]=d[S]=d[P]=d[E]=d[M]=d[A]=d[O]=d[l]=!1;var y="object"==te(ve)&&ve&&ve.Object===Object&&ve,v="object"==("undefined"==typeof self?"undefined":te(self))&&self&&self.Object===Object&&self,T=y||v||Function("return this")(),F=e&&!e.nodeType&&e,G=F&&t&&!t.nodeType&&t,B=G&&G.exports===F,R=B&&y.process,X=function(){try{return R&&R.binding&&R.binding("util")}catch(t){}}(),Y=X&&X.isTypedArray;function D(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}function I(t){var r=-1,n=Array(t.size);return t.forEach(function(t,e){n[++r]=[e,t]}),n}function N(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var $,z,q,U=Array.prototype,V=Function.prototype,J=Object.prototype,W=T["__core-js_shared__"],K=V.toString,H=J.hasOwnProperty,Q=($=/[^.]+$/.exec(W&&W.keys&&W.keys.IE_PROTO||""))?"Symbol(src)_1."+$:"",Z=J.toString,tt=RegExp("^"+K.call(H).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),et=B?T.Buffer:void 0,rt=T.Symbol,nt=T.Uint8Array,ot=J.propertyIsEnumerable,it=U.splice,at=rt?rt.toStringTag:void 0,st=Object.getOwnPropertySymbols,ut=et?et.isBuffer:void 0,ct=(z=Object.keys,q=Object,function(t){return z(q(t))}),ft=Xt(T,"DataView"),lt=Xt(T,"Map"),ht=Xt(T,"Promise"),pt=Xt(T,"Set"),dt=Xt(T,"WeakMap"),yt=Xt(Object,"create"),vt=Nt(ft),_t=Nt(lt),mt=Nt(ht),gt=Nt(pt),bt=Nt(dt),wt=rt?rt.prototype:void 0,xt=wt?wt.valueOf:void 0;function jt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function St(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Pt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Et(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new Pt;++e<r;)this.add(t[e])}function Mt(t){var e=this.__data__=new St(t);this.size=e.size}function At(t,e){var r=qt(t),n=!r&&zt(t),o=!r&&!n&&Ut(t),i=!r&&!n&&!o&&Qt(t),a=r||n||o||i,s=a?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],u=s.length;for(var c in t)!e&&!H.call(t,c)||a&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||It(c,u))||s.push(c);return s}function Ot(t,e){for(var r=t.length;r--;)if($t(t[r][0],e))return r;return-1}function Ct(t){return null==t?void 0===t?f:s:at&&at in Object(t)?function(t){var e=H.call(t,at),r=t[at];try{var n=!(t[at]=void 0)}catch(t){}var o=Z.call(t);n&&(e?t[at]=r:delete t[at]);return o}(t):(e=t,Z.call(e));var e}function Lt(t){return Kt(t)&&Ct(t)==m}function kt(t,e,r,n,o){return t===e||(null==t||null==e||!Kt(t)&&!Kt(e)?t!=t&&e!=e:function(t,e,r,n,o,i){var a=qt(t),s=qt(e),u=a?g:Dt(t),c=s?g:Dt(e),f=(u=u==m?E:u)==E,l=(c=c==m?E:c)==E,h=u==c;if(h&&Ut(t)){if(!Ut(e))return!1;f=!(a=!0)}if(h&&!f)return i||(i=new Mt),a||Qt(t)?Gt(t,e,r,n,o,i):function(t,e,r,n,o,i,a){switch(r){case k:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case L:return!(t.byteLength!=e.byteLength||!i(new nt(t),new nt(e)));case w:case x:case P:return $t(+t,+e);case j:return t.name==e.name&&t.message==e.message;case M:case O:return t==e+"";case S:var s=I;case A:var u=n&b;if(s||(s=N),t.size!=e.size&&!u)return!1;var c=a.get(t);if(c)return c==e;n|=_,a.set(t,e);var f=Gt(s(t),s(e),n,o,i,a);return a.delete(t),f;case C:if(xt)return xt.call(t)==xt.call(e)}return!1}(t,e,u,r,n,o,i);if(!(r&b)){var p=f&&H.call(t,"__wrapped__"),d=l&&H.call(e,"__wrapped__");if(p||d){var y=p?t.value():t,v=d?e.value():e;return i||(i=new Mt),o(y,v,r,n,i)}}if(!h)return!1;return i||(i=new Mt),function(t,e,r,n,o,i){var a=r&b,s=Bt(t),u=s.length,c=Bt(e).length;if(u!=c&&!a)return!1;for(var f=u;f--;){var l=s[f];if(!(a?l in e:H.call(e,l)))return!1}var h=i.get(t);if(h&&i.get(e))return h==e;var p=!0;i.set(t,e),i.set(e,t);for(var d=a;++f<u;){l=s[f];var y=t[l],v=e[l];if(n)var _=a?n(v,y,l,e,t,i):n(y,v,l,t,e,i);if(!(void 0===_?y===v||o(y,v,r,n,i):_)){p=!1;break}d||(d="constructor"==l)}if(p&&!d){var m=t.constructor,g=e.constructor;m!=g&&"constructor"in t&&"constructor"in e&&!("function"==typeof m&&m instanceof m&&"function"==typeof g&&g instanceof g)&&(p=!1)}return i.delete(t),i.delete(e),p}(t,e,r,n,o,i)}(t,e,r,n,kt,o))}function Tt(t){return!(!Wt(t)||(e=t,Q&&Q in e))&&(Vt(t)?tt:h).test(Nt(t));var e}function Ft(t){if(r=(e=t)&&e.constructor,n="function"==typeof r&&r.prototype||J,e!==n)return ct(t);var e,r,n,o=[];for(var i in Object(t))H.call(t,i)&&"constructor"!=i&&o.push(i);return o}function Gt(t,e,n,o,i,a){var r=n&b,s=t.length,u=e.length;if(s!=u&&!(r&&s<u))return!1;var c=a.get(t);if(c&&a.get(e))return c==e;var f=-1,l=!0,h=n&_?new Et:void 0;for(a.set(t,e),a.set(e,t);++f<s;){var p=t[f],d=e[f];if(o)var y=r?o(d,p,f,e,t,a):o(p,d,f,t,e,a);if(void 0!==y){if(y)continue;l=!1;break}if(h){if(!D(e,function(t,e){if(r=e,!h.has(r)&&(p===t||i(p,t,n,o,a)))return h.push(e);var r})){l=!1;break}}else if(p!==d&&!i(p,d,n,o,a)){l=!1;break}}return a.delete(t),a.delete(e),l}function Bt(t){return r=Yt,n=Zt(e=t),qt(e)?n:function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}(n,r(e));var e,r,n}function Rt(t,e){var r,n,o=t.__data__;return("string"==(n=void 0===(r=e)?"undefined":te(r))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function Xt(t,e){var r,n,o=(n=e,null==(r=t)?void 0:r[n]);return Tt(o)?o:void 0}jt.prototype.clear=function(){this.__data__=yt?yt(null):{},this.size=0},jt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},jt.prototype.get=function(t){var e=this.__data__;if(yt){var r=e[t];return r===n?void 0:r}return H.call(e,t)?e[t]:void 0},jt.prototype.has=function(t){var e=this.__data__;return yt?void 0!==e[t]:H.call(e,t)},jt.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=yt&&void 0===e?n:e,this},St.prototype.clear=function(){this.__data__=[],this.size=0},St.prototype.delete=function(t){var e=this.__data__,r=Ot(e,t);return!(r<0||(r==e.length-1?e.pop():it.call(e,r,1),--this.size,0))},St.prototype.get=function(t){var e=this.__data__,r=Ot(e,t);return r<0?void 0:e[r][1]},St.prototype.has=function(t){return-1<Ot(this.__data__,t)},St.prototype.set=function(t,e){var r=this.__data__,n=Ot(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this},Pt.prototype.clear=function(){this.size=0,this.__data__={hash:new jt,map:new(lt||St),string:new jt}},Pt.prototype.delete=function(t){var e=Rt(this,t).delete(t);return this.size-=e?1:0,e},Pt.prototype.get=function(t){return Rt(this,t).get(t)},Pt.prototype.has=function(t){return Rt(this,t).has(t)},Pt.prototype.set=function(t,e){var r=Rt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this},Et.prototype.add=Et.prototype.push=function(t){return this.__data__.set(t,n),this},Et.prototype.has=function(t){return this.__data__.has(t)},Mt.prototype.clear=function(){this.__data__=new St,this.size=0},Mt.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},Mt.prototype.get=function(t){return this.__data__.get(t)},Mt.prototype.has=function(t){return this.__data__.has(t)},Mt.prototype.set=function(t,e){var r=this.__data__;if(r instanceof St){var n=r.__data__;if(!lt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Pt(n)}return r.set(t,e),this.size=r.size,this};var Yt=st?function(e){return null==e?[]:(e=Object(e),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var a=t[r];e(a,r,t)&&(i[o++]=a)}return i}(st(e),function(t){return ot.call(e,t)}))}:function(){return[]},Dt=Ct;function It(t,e){return!!(e=null==e?r:e)&&("number"==typeof t||p.test(t))&&-1<t&&t%1==0&&t<e}function Nt(t){if(null!=t){try{return K.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function $t(t,e){return t===e||t!=t&&e!=e}(ft&&Dt(new ft(new ArrayBuffer(1)))!=k||lt&&Dt(new lt)!=S||ht&&Dt(ht.resolve())!=u||pt&&Dt(new pt)!=A||dt&&Dt(new dt)!=l)&&(Dt=function(t){var e=Ct(t),r=e==E?t.constructor:void 0,n=r?Nt(r):"";if(n)switch(n){case vt:return k;case _t:return S;case mt:return u;case gt:return A;case bt:return l}return e});var zt=Lt(function(){return arguments}())?Lt:function(t){return Kt(t)&&H.call(t,"callee")&&!ot.call(t,"callee")},qt=Array.isArray;var Ut=ut||function(){return!1};function Vt(t){if(!Wt(t))return!1;var e=Ct(t);return e==i||e==a||e==o||e==c}function Jt(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=r}function Wt(t){var e=void 0===t?"undefined":te(t);return null!=t&&("object"==e||"function"==e)}function Kt(t){return null!=t&&"object"==(void 0===t?"undefined":te(t))}var Ht,Qt=Y?(Ht=Y,function(t){return Ht(t)}):function(t){return Kt(t)&&Jt(t.length)&&!!d[Ct(t)]};function Zt(t){return null!=(e=t)&&Jt(e.length)&&!Vt(e)?At(t):Ft(t);var e}t.exports=function(t,e){return kt(t,e)}}),L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k="__lodash_hash_undefined__",T=9007199254740991,F="[object Arguments]",G="[object Function]",B="[object GeneratorFunction]",R=/^\[object .+?Constructor\]$/,X="object"==L(ve)&&ve&&ve.Object===Object&&ve,Y="object"==("undefined"==typeof self?"undefined":L(self))&&self&&self.Object===Object&&self,D=X||Y||Function("return this")();function I(t,e){return!!(t?t.length:0)&&-1<function(t,e,r){if(e!=e)return function(t,e,r,n){var o=t.length,i=r+(n?1:-1);for(;n?i--:++i<o;)if(e(t[i],i,t))return i;return-1}(t,z,r);var n=r-1,o=t.length;for(;++n<o;)if(t[n]===e)return n;return-1}(t,e,0)}function N(t,e,r){for(var n=-1,o=t?t.length:0;++n<o;)if(r(e,t[n]))return!0;return!1}function $(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}function z(t){return t!=t}function q(t,e){return t.has(e)}var U,V=Array.prototype,J=Function.prototype,W=Object.prototype,K=D["__core-js_shared__"],H=(U=/[^.]+$/.exec(K&&K.keys&&K.keys.IE_PROTO||""))?"Symbol(src)_1."+U:"",Q=J.toString,Z=W.hasOwnProperty,tt=W.toString,et=RegExp("^"+Q.call(Z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),rt=D.Symbol,nt=W.propertyIsEnumerable,ot=V.splice,it=rt?rt.isConcatSpreadable:void 0,at=Math.max,st=_t(D,"Map"),ut=_t(Object,"create");function ct(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function ft(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function lt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function ht(t){var e=-1,r=t?t.length:0;for(this.__data__=new lt;++e<r;)this.add(t[e])}function pt(t,e){for(var r,n,o=t.length;o--;)if((r=t[o][0])===(n=e)||r!=r&&n!=n)return o;return-1}function dt(t,e,r,n){var o,i=-1,a=I,s=!0,u=t.length,c=[],f=e.length;if(!u)return c;r&&(e=function(t,e){for(var r=-1,n=t?t.length:0,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}(e,(o=r,function(t){return o(t)}))),n?(a=N,s=!1):200<=e.length&&(a=q,s=!1,e=new ht(e));t:for(;++i<u;){var l=t[i],h=r?r(l):l;if(l=n||0!==l?l:0,s&&h==h){for(var p=f;p--;)if(e[p]===h)continue t;c.push(l)}else a(e,h,n)||c.push(l)}return c}function yt(t){return!(!Et(t)||(e=t,H&&H in e))&&(Pt(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?et:R).test(function(t){if(null!=t){try{return Q.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e}function vt(t,e){var r,n,o=t.__data__;return("string"==(n=void 0===(r=e)?"undefined":L(r))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function _t(t,e){var r,n,o=(n=e,null==(r=t)?void 0:r[n]);return yt(o)?o:void 0}function mt(t){return xt(t)||St(e=t)&&Z.call(e,"callee")&&(!nt.call(e,"callee")||tt.call(e)==F)||!!(it&&t&&t[it]);var e}ct.prototype.clear=function(){this.__data__=ut?ut(null):{}},ct.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},ct.prototype.get=function(t){var e=this.__data__;if(ut){var r=e[t];return r===k?void 0:r}return Z.call(e,t)?e[t]:void 0},ct.prototype.has=function(t){var e=this.__data__;return ut?void 0!==e[t]:Z.call(e,t)},ct.prototype.set=function(t,e){return this.__data__[t]=ut&&void 0===e?k:e,this},ft.prototype.clear=function(){this.__data__=[]},ft.prototype.delete=function(t){var e=this.__data__,r=pt(e,t);return!(r<0||(r==e.length-1?e.pop():ot.call(e,r,1),0))},ft.prototype.get=function(t){var e=this.__data__,r=pt(e,t);return r<0?void 0:e[r][1]},ft.prototype.has=function(t){return-1<pt(this.__data__,t)},ft.prototype.set=function(t,e){var r=this.__data__,n=pt(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},lt.prototype.clear=function(){this.__data__={hash:new ct,map:new(st||ft),string:new ct}},lt.prototype.delete=function(t){return vt(this,t).delete(t)},lt.prototype.get=function(t){return vt(this,t).get(t)},lt.prototype.has=function(t){return vt(this,t).has(t)},lt.prototype.set=function(t,e){return vt(this,t).set(t,e),this},ht.prototype.add=ht.prototype.push=function(t){return this.__data__.set(t,k),this},ht.prototype.has=function(t){return this.__data__.has(t)};var gt,bt,wt=(gt=function(t,e){var r,n,o=(n=(r=e)?r.length:0)?r[n-1]:void 0;return St(o)&&(o=void 0),St(t)?dt(t,function t(e,r,n,o,i){var a=-1,s=e.length;for(n||(n=mt),i||(i=[]);++a<s;){var u=e[a];0<r&&n(u)?1<r?t(u,r-1,n,o,i):$(i,u):o||(i[i.length]=u)}return i}(e,1,St,!0),void 0,o):[]},bt=at(void 0===bt?gt.length-1:bt,0),function(){for(var t=arguments,e=-1,r=at(t.length-bt,0),n=Array(r);++e<r;)n[e]=t[bt+e];e=-1;for(var o=Array(bt+1);++e<bt;)o[e]=t[e];return o[bt]=n,function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}(gt,this,o)});var xt=Array.isArray;function jt(t){return null!=t&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=T)&&!Pt(t);var e}function St(t){return!!(e=t)&&"object"==(void 0===e?"undefined":L(e))&&jt(t);var e}function Pt(t){var e=Et(t)?tt.call(t):"";return e==G||e==B}function Et(t){var e=void 0===t?"undefined":L(t);return!!t&&("object"==e||"function"==e)}var Mt=wt,_e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},At=r(function(t,e){var r="Expected a function",n="__lodash_hash_undefined__",_=1,b=2,s=1/0,o=9007199254740991,u=17976931348623157e292,c=NaN,m="[object Arguments]",g="[object Array]",w="[object Boolean]",x="[object Date]",j="[object Error]",i="[object Function]",a="[object GeneratorFunction]",S="[object Map]",P="[object Number]",E="[object Object]",f="[object Promise]",M="[object RegExp]",A="[object Set]",O="[object String]",C="[object Symbol]",l="[object WeakMap]",L="[object ArrayBuffer]",k="[object DataView]",h=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,p=/^\w*$/,d=/^\./,y=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,v=/^\s+|\s+$/g,T=/\\(\\)?/g,F=/^[-+]0x[0-9a-f]+$/i,G=/^0b[01]+$/i,B=/^\[object .+?Constructor\]$/,R=/^0o[0-7]+$/i,X=/^(?:0|[1-9]\d*)$/,Y={};Y["[object Float32Array]"]=Y["[object Float64Array]"]=Y["[object Int8Array]"]=Y["[object Int16Array]"]=Y["[object Int32Array]"]=Y["[object Uint8Array]"]=Y["[object Uint8ClampedArray]"]=Y["[object Uint16Array]"]=Y["[object Uint32Array]"]=!0,Y[m]=Y[g]=Y[L]=Y[w]=Y[k]=Y[x]=Y[j]=Y[i]=Y[S]=Y[P]=Y[E]=Y[M]=Y[A]=Y[O]=Y[l]=!1;var D=parseInt,I="object"==_e(ve)&&ve&&ve.Object===Object&&ve,N="object"==("undefined"==typeof self?"undefined":_e(self))&&self&&self.Object===Object&&self,$=I||N||Function("return this")(),z=e&&!e.nodeType&&e,q=z&&t&&!t.nodeType&&t,U=q&&q.exports===z&&I.process,V=function(){try{return U&&U.binding("util")}catch(t){}}(),J=V&&V.isTypedArray;function W(t,e){for(var r=-1,n=t?t.length:0;++r<n;)if(e(t[r],r,t))return!0;return!1}function K(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function H(t){var r=-1,n=Array(t.size);return t.forEach(function(t,e){n[++r]=[e,t]}),n}function Q(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var Z,tt,et,rt=Array.prototype,nt=Function.prototype,ot=Object.prototype,it=$["__core-js_shared__"],at=(Z=/[^.]+$/.exec(it&&it.keys&&it.keys.IE_PROTO||""))?"Symbol(src)_1."+Z:"",st=nt.toString,ut=ot.hasOwnProperty,ct=ot.toString,ft=RegExp("^"+st.call(ut).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),lt=$.Symbol,ht=$.Uint8Array,pt=ot.propertyIsEnumerable,dt=rt.splice,yt=(tt=Object.keys,et=Object,function(t){return tt(et(t))}),vt=Math.max,_t=Vt($,"DataView"),mt=Vt($,"Map"),gt=Vt($,"Promise"),bt=Vt($,"Set"),wt=Vt($,"WeakMap"),xt=Vt(Object,"create"),jt=ee(_t),St=ee(mt),Pt=ee(gt),Et=ee(bt),Mt=ee(wt),At=lt?lt.prototype:void 0,Ot=At?At.valueOf:void 0,Ct=At?At.toString:void 0;function Lt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function kt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Tt(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Ft(t){var e=-1,r=t?t.length:0;for(this.__data__=new Tt;++e<r;)this.add(t[e])}function Gt(t){this.__data__=new kt(t)}function Bt(t,e){var r=ie(t)||oe(t)?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],n=r.length,o=!!n;for(var i in t)!e&&!ut.call(t,i)||o&&("length"==i||Wt(i,n))||r.push(i);return r}function Rt(t,e){for(var r=t.length;r--;)if(ne(t[r][0],e))return r;return-1}function Xt(t,e){for(var r=0,n=(e=Kt(e,t)?[e]:zt(e)).length;null!=t&&r<n;)t=t[te(e[r++])];return r&&r==n?t:void 0}function Yt(t,e){return null!=t&&e in Object(t)}function Dt(t,e,r,n,o){return t===e||(null==t||null==e||!ce(t)&&!fe(e)?t!=t&&e!=e:function(t,e,r,n,o,i){var a=ie(t),s=ie(e),u=g,c=g;a||(u=(u=Jt(t))==m?E:u);s||(c=(c=Jt(e))==m?E:c);var f=u==E&&!K(t),l=c==E&&!K(e),h=u==c;if(h&&!f)return i||(i=new Gt),a||pe(t)?qt(t,e,r,n,o,i):function(t,e,r,n,o,i,a){switch(r){case k:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case L:return!(t.byteLength!=e.byteLength||!n(new ht(t),new ht(e)));case w:case x:case P:return ne(+t,+e);case j:return t.name==e.name&&t.message==e.message;case M:case O:return t==e+"";case S:var s=H;case A:var u=i&b;if(s||(s=Q),t.size!=e.size&&!u)return!1;var c=a.get(t);if(c)return c==e;i|=_,a.set(t,e);var f=qt(s(t),s(e),n,o,i,a);return a.delete(t),f;case C:if(Ot)return Ot.call(t)==Ot.call(e)}return!1}(t,e,u,r,n,o,i);if(!(o&b)){var p=f&&ut.call(t,"__wrapped__"),d=l&&ut.call(e,"__wrapped__");if(p||d){var y=p?t.value():t,v=d?e.value():e;return i||(i=new Gt),r(y,v,n,o,i)}}if(!h)return!1;return i||(i=new Gt),function(t,e,r,n,o,i){var a=o&b,s=de(t),u=s.length,c=de(e).length;if(u!=c&&!a)return!1;for(var f=u;f--;){var l=s[f];if(!(a?l in e:ut.call(e,l)))return!1}var h=i.get(t);if(h&&i.get(e))return h==e;var p=!0;i.set(t,e),i.set(e,t);for(var d=a;++f<u;){l=s[f];var y=t[l],v=e[l];if(n)var _=a?n(v,y,l,e,t,i):n(y,v,l,t,e,i);if(!(void 0===_?y===v||r(y,v,n,o,i):_)){p=!1;break}d||(d="constructor"==l)}if(p&&!d){var m=t.constructor,g=e.constructor;m!=g&&"constructor"in t&&"constructor"in e&&!("function"==typeof m&&m instanceof m&&"function"==typeof g&&g instanceof g)&&(p=!1)}return i.delete(t),i.delete(e),p}(t,e,r,n,o,i)}(t,e,Dt,r,n,o))}function It(t){return!(!ce(t)||(e=t,at&&at in e))&&(se(t)||K(t)?ft:B).test(ee(t));var e}function Nt(t){return"function"==typeof t?t:null==t?ye:"object"==(void 0===t?"undefined":_e(t))?ie(t)?function(u,c){if(Kt(u)&&Ht(c))return Qt(te(u),c);return function(t){var e,r,n,o,i,a,s=(r=u,void 0===(o=null==(e=t)?void 0:Xt(e,r))?n:o);return void 0===s&&s===c?(a=u,null!=(i=t)&&function(t,e,r){e=Kt(e,t)?[e]:zt(e);for(var n,o=-1,i=e.length;++o<i;){var a=te(e[o]);if(!(n=null!=t&&r(t,a)))break;t=t[a]}return n||!!(i=t?t.length:0)&&ue(i)&&Wt(a,i)&&(ie(t)||oe(t))}(i,a,Yt)):Dt(c,s,void 0,_|b)}}(t[0],t[1]):function(e){var r=function(t){var e=de(t),r=e.length;for(;r--;){var n=e[r],o=t[n];e[r]=[n,o,Ht(o)]}return e}(e);if(1==r.length&&r[0][2])return Qt(r[0][0],r[0][1]);return function(t){return t===e||function(t,e,r,n){var o=r.length,i=o,a=!n;if(null==t)return!i;for(t=Object(t);o--;){var s=r[o];if(a&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++o<i;){var u=(s=r[o])[0],c=t[u],f=s[1];if(a&&s[2]){if(void 0===c&&!(u in t))return!1}else{var l=new Gt;if(n)var h=n(c,f,u,t,e,l);if(!(void 0===h?Dt(f,c,n,_|b,l):h))return!1}}return!0}(t,e,r)}}(t):Kt(e=t)?(n=te(e),function(t){return null==t?void 0:t[n]}):(r=e,function(t){return Xt(t,r)});var e,r,n}function $t(t){if(r=(e=t)&&e.constructor,n="function"==typeof r&&r.prototype||ot,e!==n)return yt(t);var e,r,n,o=[];for(var i in Object(t))ut.call(t,i)&&"constructor"!=i&&o.push(i);return o}function zt(t){return ie(t)?t:Zt(t)}function qt(t,e,r,n,o,i){var a=o&b,s=t.length,u=e.length;if(s!=u&&!(a&&s<u))return!1;var c=i.get(t);if(c&&i.get(e))return c==e;var f=-1,l=!0,h=o&_?new Ft:void 0;for(i.set(t,e),i.set(e,t);++f<s;){var p=t[f],d=e[f];if(n)var y=a?n(d,p,f,e,t,i):n(p,d,f,t,e,i);if(void 0!==y){if(y)continue;l=!1;break}if(h){if(!W(e,function(t,e){if(!h.has(e)&&(p===t||r(p,t,n,o,i)))return h.add(e)})){l=!1;break}}else if(p!==d&&!r(p,d,n,o,i)){l=!1;break}}return i.delete(t),i.delete(e),l}function Ut(t,e){var r,n,o=t.__data__;return("string"==(n=void 0===(r=e)?"undefined":_e(r))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function Vt(t,e){var r,n,o=(n=e,null==(r=t)?void 0:r[n]);return It(o)?o:void 0}Lt.prototype.clear=function(){this.__data__=xt?xt(null):{}},Lt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},Lt.prototype.get=function(t){var e=this.__data__;if(xt){var r=e[t];return r===n?void 0:r}return ut.call(e,t)?e[t]:void 0},Lt.prototype.has=function(t){var e=this.__data__;return xt?void 0!==e[t]:ut.call(e,t)},Lt.prototype.set=function(t,e){return this.__data__[t]=xt&&void 0===e?n:e,this},kt.prototype.clear=function(){this.__data__=[]},kt.prototype.delete=function(t){var e=this.__data__,r=Rt(e,t);return!(r<0||(r==e.length-1?e.pop():dt.call(e,r,1),0))},kt.prototype.get=function(t){var e=this.__data__,r=Rt(e,t);return r<0?void 0:e[r][1]},kt.prototype.has=function(t){return-1<Rt(this.__data__,t)},kt.prototype.set=function(t,e){var r=this.__data__,n=Rt(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},Tt.prototype.clear=function(){this.__data__={hash:new Lt,map:new(mt||kt),string:new Lt}},Tt.prototype.delete=function(t){return Ut(this,t).delete(t)},Tt.prototype.get=function(t){return Ut(this,t).get(t)},Tt.prototype.has=function(t){return Ut(this,t).has(t)},Tt.prototype.set=function(t,e){return Ut(this,t).set(t,e),this},Ft.prototype.add=Ft.prototype.push=function(t){return this.__data__.set(t,n),this},Ft.prototype.has=function(t){return this.__data__.has(t)},Gt.prototype.clear=function(){this.__data__=new kt},Gt.prototype.delete=function(t){return this.__data__.delete(t)},Gt.prototype.get=function(t){return this.__data__.get(t)},Gt.prototype.has=function(t){return this.__data__.has(t)},Gt.prototype.set=function(t,e){var r=this.__data__;if(r instanceof kt){var n=r.__data__;if(!mt||n.length<199)return n.push([t,e]),this;r=this.__data__=new Tt(n)}return r.set(t,e),this};var Jt=function(t){return ct.call(t)};function Wt(t,e){return!!(e=null==e?o:e)&&("number"==typeof t||X.test(t))&&-1<t&&t%1==0&&t<e}function Kt(t,e){if(ie(t))return!1;var r=void 0===t?"undefined":_e(t);return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!le(t))||(p.test(t)||!h.test(t)||null!=e&&t in Object(e))}function Ht(t){return t==t&&!ce(t)}function Qt(e,r){return function(t){return null!=t&&(t[e]===r&&(void 0!==r||e in Object(t)))}}(_t&&Jt(new _t(new ArrayBuffer(1)))!=k||mt&&Jt(new mt)!=S||gt&&Jt(gt.resolve())!=f||bt&&Jt(new bt)!=A||wt&&Jt(new wt)!=l)&&(Jt=function(t){var e=ct.call(t),r=e==E?t.constructor:void 0,n=r?ee(r):void 0;if(n)switch(n){case jt:return k;case St:return S;case Pt:return f;case Et:return A;case Mt:return l}return e});var Zt=re(function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(le(t))return Ct?Ct.call(t):"";var e=t+"";return"0"==e&&1/t==-s?"-0":e}(e);var o=[];return d.test(t)&&o.push(""),t.replace(y,function(t,e,r,n){o.push(r?n.replace(T,"$1"):e||t)}),o});function te(t){if("string"==typeof t||le(t))return t;var e=t+"";return"0"==e&&1/t==-s?"-0":e}function ee(t){if(null!=t){try{return st.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function re(i,a){if("function"!=typeof i||a&&"function"!=typeof a)throw new TypeError(r);var t=function t(){var e=arguments,r=a?a.apply(this,e):e[0],n=t.cache;if(n.has(r))return n.get(r);var o=i.apply(this,e);return t.cache=n.set(r,o),o};return t.cache=new(re.Cache||Tt),t}function ne(t,e){return t===e||t!=t&&e!=e}function oe(t){return fe(e=t)&&ae(e)&&ut.call(t,"callee")&&(!pt.call(t,"callee")||ct.call(t)==m);var e}re.Cache=Tt;var ie=Array.isArray;function ae(t){return null!=t&&ue(t.length)&&!se(t)}function se(t){var e=ce(t)?ct.call(t):"";return e==i||e==a}function ue(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=o}function ce(t){var e=void 0===t?"undefined":_e(t);return!!t&&("object"==e||"function"==e)}function fe(t){return!!t&&"object"==(void 0===t?"undefined":_e(t))}function le(t){return"symbol"==(void 0===t?"undefined":_e(t))||fe(t)&&ct.call(t)==C}var he,pe=J?(he=J,function(t){return he(t)}):function(t){return fe(t)&&ue(t.length)&&!!Y[ct.call(t)]};function de(t){return ae(t)?Bt(t):$t(t)}function ye(t){return t}t.exports=function(t,e,r){var n=t?t.length:0;if(!n)return-1;var o,i,a=null==r?0:(o=function(t){if(!t)return 0===t?t:0;if((t=function(t){if("number"==typeof t)return t;if(le(t))return c;if(ce(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=ce(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(v,"");var r=G.test(t);return r||R.test(t)?D(t.slice(2),r?2:8):F.test(t)?c:+t}(t))===s||t===-s){var e=t<0?-1:1;return e*u}return t==t?t:0}(r),i=o%1,o==o?i?o-i:o:0);return a<0&&(a=vt(n+a,0)),function(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1}(t,Nt(e),a)}}),Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ct=1/0,Lt=9007199254740991,kt=17976931348623157e292,Tt=NaN,Ft="[object Arguments]",Gt="[object Function]",Bt="[object GeneratorFunction]",Rt="[object String]",Xt="[object Symbol]",Yt=/^\s+|\s+$/g,Dt=/^[-+]0x[0-9a-f]+$/i,It=/^0b[01]+$/i,Nt=/^0o[0-7]+$/i,$t=/^(?:0|[1-9]\d*)$/,zt=parseInt;function qt(t){return t!=t}function Ut(e,t){return function(t,e){for(var r=-1,n=t?t.length:0,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}(t,function(t){return e[t]})}var Vt,Jt,Wt=Object.prototype,Kt=Wt.hasOwnProperty,Ht=Wt.toString,Qt=Wt.propertyIsEnumerable,Zt=(Vt=Object.keys,Jt=Object,function(t){return Vt(Jt(t))}),ee=Math.max;function re(t,e){var r,n,o=ie(t)||ue(n=r=t)&&ae(n)&&Kt.call(r,"callee")&&(!Qt.call(r,"callee")||Ht.call(r)==Ft)?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],i=o.length,a=!!i;for(var s in t)!e&&!Kt.call(t,s)||a&&("length"==s||oe(s,i))||o.push(s);return o}function ne(t){if(r=(e=t)&&e.constructor,n="function"==typeof r&&r.prototype||Wt,e!==n)return Zt(t);var e,r,n,o=[];for(var i in Object(t))Kt.call(t,i)&&"constructor"!=i&&o.push(i);return o}function oe(t,e){return!!(e=null==e?Lt:e)&&("number"==typeof t||$t.test(t))&&-1<t&&t%1==0&&t<e}var ie=Array.isArray;function ae(t){return null!=t&&("number"==typeof(n=t.length)&&-1<n&&n%1==0&&n<=Lt)&&!((r=se(e=t)?Ht.call(e):"")==Gt||r==Bt);var e,r,n}function se(t){var e=void 0===t?"undefined":Ot(t);return!!t&&("object"==e||"function"==e)}function ue(t){return!!t&&"object"==(void 0===t?"undefined":Ot(t))}var ce=function(t,e,r,n){var o,i,a,s;t=ae(t)?t:(o=t)?Ut(o,ae(i=o)?re(i):ne(i)):[],r=r&&!n?(a=function(t){if(!t)return 0===t?t:0;if((t=function(t){if("number"==typeof t)return t;if("symbol"==(void 0===(e=t)?"undefined":Ot(e))||ue(e)&&Ht.call(e)==Xt)return Tt;var e;if(se(t)){var r="function"==typeof t.valueOf?t.valueOf():t;t=se(r)?r+"":r}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(Yt,"");var n=It.test(t);return n||Nt.test(t)?zt(t.slice(2),n?2:8):Dt.test(t)?Tt:+t}(t))===Ct||t===-Ct){var e=t<0?-1:1;return e*kt}return t==t?t:0}(r),s=a%1,a==a?s?a-s:a:0):0;var u,c=t.length;return r<0&&(r=ee(c+r,0)),"string"==typeof(u=t)||!ie(u)&&ue(u)&&Ht.call(u)==Rt?r<=c&&-1<t.indexOf(e,r):!!c&&-1<function(t,e,r){if(e!=e)return function(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1}(t,qt,r);for(var n=r-1,o=t.length;++n<o;)if(t[n]===e)return n;return-1}(t,e,r)},fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},le=9007199254740991,he="[object Arguments]",pe="[object Function]",de="[object GeneratorFunction]",ye="object"==fe(ve)&&ve&&ve.Object===Object&&ve,me="object"==("undefined"==typeof self?"undefined":fe(self))&&self&&self.Object===Object&&self,ge=ye||me||Function("return this")();function be(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}var we=Object.prototype,xe=we.hasOwnProperty,je=we.toString,Se=ge.Symbol,Pe=we.propertyIsEnumerable,Ee=Se?Se.isConcatSpreadable:void 0;function Me(t){return Ae(t)||!!(c=r=e=t)&&"object"==(void 0===c?"undefined":fe(c))&&(null!=(n=r)&&("number"==typeof(u=n.length)&&-1<u&&u%1==0&&u<=le)&&(s=void 0===(a=o=n)?"undefined":fe(a),!((i=!a||"object"!=s&&"function"!=s?"":je.call(o))==pe||i==de)))&&xe.call(e,"callee")&&(!Pe.call(e,"callee")||je.call(e)==he)||!!(Ee&&t&&t[Ee]);var e,r,n,o,i,a,s,u,c}var Ae=Array.isArray;var Oe=function(t){return t&&t.length?function t(e,r,n,o,i){var a=-1,s=e.length;for(n||(n=Me),i||(i=[]);++a<s;){var u=e[a];0<r&&n(u)?1<r?t(u,r-1,n,o,i):be(i,u):o||(i[i.length]=u)}return i}(t,1/0):[]};function Ce(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++){var o=r[n],i=Object.getOwnPropertyDescriptor(e,o);i&&i.configurable&&void 0===t[o]&&Object.defineProperty(t,o,i)}}(t,e))}var Le={mode:"auto",distance:10,needCtrl:!1},ke=function(r){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,r.call(this,t));return e.tree=A(),e._layerName=d.INTERNAL_LAYER_PREFIX+"_Autoadsorb",e._isEnable=!1,e._updateModeType(),e._updateDistance(),e._updateNeedCtrl(),e}return Ce(n,r),n.prototype.setLayer=function(t){var e=this;if(t instanceof d.VectorLayer){var r=t.map;this._addTo(r),this.adsorblayer=t,this.adsorblayer.on("addgeo",function(){return e._updateGeosSet()},this),this.adsorblayer.on("clear",function(){return e._resetGeosSet()},this),this.bindDrawTool(r._map_tool)}return this},n.prototype.bindDrawTool=function(t){var e=this;return t instanceof d.DrawTool&&((this.drawTool=t).on("enable",function(t){return e.enable()},this),t.on("disable",function(t){return e.disable()},this),t.on("remove",function(t){return e.remove()},this),t.isEnabled()&&this.enable()),this},n.prototype.setGeometry=function(t){if(t instanceof d.Geometry){var e=t._layer,r=e.map;r._map_tool&&r._map_tool instanceof d.DrawTool&&r._map_tool.disable(),this._addTo(r),this.adsorblayer=e,this.bindGeometry(t)}return this},n.prototype.bindGeometry=function(t){var e=this;if(t instanceof d.Geometry){if(this.geometry)return this.setGeometry(t);this.geometry=t,this.geometryCoords=t.getCoordinates(),t.on("editstart",function(t){return e.enable()},this),t.on("editend",function(t){return e.disable()},this),t.on("remove",function(t){return e.remove()},this),t.isEditing()?(t.endEdit(),this.enable(),t.startEdit()):t.startEdit().endEdit()}return this},n.prototype.enable=function(){return this._isEnable=!0,this._updateGeosSet(),this._registerMapEvents(),this.drawTool&&this._registerDrawToolEvents(),this.geometry&&this._registerGeometryEvents(),this._mousemoveLayer&&this._mousemoveLayer.show(),this},n.prototype.disable=function(){return this._isEnable=!1,this._offMapEvents(),this._offDrawToolEvents(),this._offGeometryEvents(),this._resetGeosSet(),delete this._mousemove,delete this._mousedown,delete this._mouseup,this._mousemoveLayer&&this._mousemoveLayer.hide(),this},n.prototype.isEnable=function(){return this._isEnable},n.prototype.toggleEnable=function(){return this._isEnable?this.disable():this.enable()},n.prototype.remove=function(){this.disable();var t=map.getLayer(this._layerName);t&&t.remove(),delete this.geometry,delete this.geometryCoords,delete this._geosSetPoint,delete this._geosSetLine,delete this._mousemoveLayer,delete this._assistLayers},n.prototype.setMode=function(t){return this._updateModeType(t),this._updateGeosSet(),this},n.prototype.getMode=function(){return this._mode},n.prototype.setDistance=function(t){return this._updateDistance(t),this._updateGeosSet(),this},n.prototype.getDistance=function(){return this._distance},n.prototype.needCtrl=function(t){return this._updateNeedCtrl(t),this},n.prototype.setAssistGeosLayer=function(t){if(t){var r=this._map;t instanceof Array||(t=[t]);var n=this.adsorblayer.getId(),e=t.reduce(function(t,e){return e===n||r.getLayer(e)instanceof d.VectorLayer&&(t=[].concat(t,[e])),t},[]);0<e.length&&(this._assistLayers=e)}else this._assistLayers=void 0;return this._updateGeosSet(),this},n.prototype._updateModeType=function(t){this._mode=t||this.options.mode||Le.mode},n.prototype._updateDistance=function(t){t=t||this.options.distance||Le.distance,this._distance=Math.max(t,1)},n.prototype._updateNeedCtrl=function(t){t=void 0!==(t=void 0!==t?t:this.options.needCtrl)?t:Le.needCtrl,this._needCtrl=t},n.prototype._addTo=function(t){return t.getLayer(this._layerName)&&this.remove(),this._mousemoveLayer=new d.VectorLayer(this._layerName).addTo(t).bringToFront(),this._map=t,this._resetGeosSet(),this},n.prototype._updateGeosSet=function(){var e=this,t=this._getGeosSet(),r="auto"===this._mode,n="vertux"===this._mode,o="border"===this._mode,i=[],a=[];t.forEach(function(t){(r||n)&&i.push.apply(i,e._parseToPoints(t)),(r||o)&&e._parseToLines(t).forEach(function(t){"Point"===t.geometry.type?i.push(t):a.push(t)})}),this._geosSetPoint=i,this._geosSetLine=a},n.prototype._getGeosSet=function(){var e=this.adsorblayer.getGeometries();return this._assistLayers&&this._assistLayers.forEach(function(t){return e.push.apply(e,map.getLayer(t).getGeometries())}),e},n.prototype._parseToPoints=function(t){var e=this;if(this._skipGeoSelf(t))return[];var r=[],n=t.getCoordinates();return n[0]instanceof Array?n.forEach(function(t){return r.push.apply(r,e._createMarkers(t))}):(n instanceof Array||(n=[n]),r.push.apply(r,this._createMarkers(n))),r},n.prototype._skipGeoSelf=function(t){if(this.geometry){var e=t.toGeoJSON().geometry.coordinates,r=this.geometry.toGeoJSON().geometry.coordinates;return C(e,r)}return!1},n.prototype._createMarkers=function(t){return Oe(t).map(function(t){return new d.Marker(t,{properties:{}}).toGeoJSON()})},n.prototype._parseToLines=function(t){if(this._skipGeoSelf(t))return[];var e=[];return"Point"===t.type?e.push(t.setProperties({}).toGeoJSON()):e.push.apply(e,this._parsePolygonToLine(t)),e},n.prototype._parsePolygonToLine=function(e){var r=this,t=e.getCoordinates(),n=[];if(t instanceof Array)switch(e.type){case"MultiPolygon":t.forEach(function(t){return t.forEach(function(t){return n.push.apply(n,r._createLine(t,e))})});break;case"Polygon":t.forEach(function(t){return n.push.apply(n,r._createLine(t,e))});break;default:n.push.apply(n,this._createLine(t,e))}else if("Polygon"===e.type){var o=e.options;o.numberOfShellPoints=300,e.setOptions(o),t=e.getShell(),o.numberOfShellPoints=60,e.setOptions(o),n.push.apply(n,this._createMarkers(t))}return n},n.prototype._createLine=function(t,e){for(var r=[],n=0;n<t.length-1;n++){var o=[t[n],t[n+1]],i=new d.LineString(o,{properties:{obj:e}}).toGeoJSON();r.push(i)}return r},n.prototype._resetGeosSet=function(){this._geosSetPoint=[],this._geosSetLine=[]},n.prototype._registerMapEvents=function(){var e=this;if(!this._mousemove){var t=this._map;this._mousemove=function(t){return e._mousemoveEvents(t)},this._mousedown=function(){e.drawTool&&(e._needFindGeometry=!1),e.geometry&&(e._needFindGeometry=!0)},this._mouseup=function(){e.drawTool&&(e._needFindGeometry=!0),e.geometry&&(e._needFindGeometry=!1)},t.on("mousemove touchstart",this._mousemove,this),t.on("mousedown",this._mousedown,this),t.on("mouseup",this._mouseup,this)}},n.prototype._offMapEvents=function(){var t=this._map;this._mousemove&&t.off("mousemove touchstart",this._mousemove,this),this._mousedown&&t.off("mousedown",this._mousedown,this),this._mouseup&&t.off("mouseup",this._mouseup,this)},n.prototype._mousemoveEvents=function(t){var e=t.coordinate,r=t.domEvent;this._needDeal=!0,this._mousePoint=e,this._marker?this._marker.setCoordinates(e):this._marker=new d.Marker(e,{symbol:{}}).addTo(this._mousemoveLayer),this._updateAdsorbPoint(e),(this._needCtrl!==r.ctrlKey||this._hasAddVertux)&&(this.adsorbPoint=null)},n.prototype._updateAdsorbPoint=function(t){if(this._needFindGeometry){var e=this._findGeometry(t);if(this.adsorbPoint=e&&0<e.features.length?this._getAdsorbPoint(e):null,this.adsorbPoint){var r=this.adsorbPoint,n=r.x,o=r.y;this._marker.setCoordinates([n,o])}}},n.prototype._findGeometry=function(t){if(!this._geosSetPoint&&!this._geosSetLine)return null;var e=[];if(this._geosSetPoint){var r=this._findAvailGeos(this._geosSetPoint,t);e.push.apply(e,r)}if(this._geosSetLine){var n=this._findAvailGeos(this._geosSetLine,t);e.push.apply(e,n)}return{type:"FeatureCollection",features:e}},n.prototype._findAvailGeos=function(t,e){this.tree.clear(),this.tree.load({type:"FeatureCollection",features:t});var r=this._createInspectExtent(e);return this.tree.search(r).features},n.prototype._createInspectExtent=function(t){var e=Math.max(parseInt(this._distance,0),1),r=this._map.pixelToDistance(0,e);return new d.Circle(t,r,{properties:{}}).toGeoJSON()},n.prototype._getAdsorbPoint=function(t){var e=this._findNearestFeatures(t.features);if(!e)return null;var r=e.geoObject,n=r.geometry,o=n.coordinates,i=n.type,a=o[0];switch(i){case"Point":return{x:a,y:o[1]};case"LineString":var s=this._setEquation(r),u=s.A,c=s.B,f=this._mousePoint,l=f.x,h=f.y;if(0===u)return{x:l,y:a[1]};if(u===1/0)return{x:a[0],y:h};var p=c/u,d=this._setVertiEquation(p);return this._solveEquation(s,d);default:return null}},n.prototype._findNearestFeatures=function(t){var e=this._setDistance(t);if(0===e.length)return null;var r;return e.sort((r="distance",function(t,e){return e[r]<t[r]}))[0]},n.prototype._setDistance=function(t){var o=this,i=-1===t.findIndex(function(t){return"Point"===t.geometry.type});return t.reduce(function(t,e,r){var n=void 0;switch(e.geometry.type){case"Point":n=o._distToPoint(e);break;case"LineString":i&&(n=o._distToPolyline(e))}return void 0!==n&&(t=[].concat(t,[{geoObject:e,distance:n}])),t},[])},n.prototype._distToPoint=function(t){var e=this._mousePoint,r=[e.x,e.y],n=t.geometry.coordinates;return Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2))},n.prototype._distToPolyline=function(t){var e=this._mousePoint,r=e.x,n=e.y,o=this._setEquation(t),i=o.A,a=o.B,s=o.C;return Math.abs((i*r+a*n+s)/Math.sqrt(Math.pow(i,2)+Math.pow(a,2)))},n.prototype._setEquation=function(t){var e=t.geometry.coordinates,r=e[0],n=e[1],o=r[0],i=r[1],a=n[0],s=(i-n[1])/(o-a);return{A:s=s===-1/0?-s:s,B:-1,C:i-s*o}},n.prototype._setVertiEquation=function(t){var e=this._mousePoint,r=e.x;return{A:t,B:-1,C:e.y-t*r}},n.prototype._solveEquation=function(t,e){var r=t.A,n=t.B,o=t.C,i=e.A,a=e.B,s=e.C;return{x:(n*s-o*a)/(r*a-i*n),y:(r*s-i*o)/(n*i-a*r)}},n.prototype._registerDrawToolEvents=function(){var e=this,t=this.drawTool;t.on("drawstart",function(t){return e._resetCoordsAndPoint(t)},this),t.on("mousemove",function(t){return e._resetCoordinates(t.target._geometry||t)},this),t.on("drawvertex",function(t){return e._resetCoordsAndPoint(t)},this),t.on("drawend",function(t){return e._resetCoordinates(t.geometry||t)},this)},n.prototype._offDrawToolEvents=function(){var e=this;if(this.drawTool){var t=this.drawTool;t.off("drawstart",function(t){return e._resetCoordsAndPoint},this),t.off("mousemove",function(t){return e._resetCoordinates},this),t.off("drawvertex",function(t){return e._resetCoordsAndPoint},this),t.off("drawend",function(t){return e._resetCoordinates},this)}},n.prototype._registerGeometryEvents=function(){var e=this,t=this.geometry;t.on("shapechange",function(t){return e._setEditCoordinates(t.target)},this),t.on("editrecord",function(t){return e._upGeoCoords(t.target.getCoordinates())},this)},n.prototype._offGeometryEvents=function(){var e=this;if(this.geometry){var t=this.geometry;t.off("shapechange",function(t){return e._setEditCoordinates},this),t.off("editrecord",function(t){return e._upGeoCoords},this)}},n.prototype._resetCoordsAndPoint=function(t){this._resetCoordinates(t.target._geometry||t),this._resetClickPoint(t.target._clickCoords)},n.prototype._resetCoordinates=function(t){if(this.adsorbPoint){var e=this.adsorbPoint,r=e.x,n=e.y;if(t instanceof d.Geometry){var o=t.getCoordinates();if(o instanceof Array){var i=o.length;i&&(o[i-1].x=r,o[i-1].y=n),t.setCoordinates(o)}else if(t instanceof d.Circle){var a=this._map.getProjection().measureLength([o,this.adsorbPoint]);t.setRadius(a)}}}},n.prototype._resetClickPoint=function(t){if(this.adsorbPoint)if(t instanceof d.Coordinate||t instanceof Array){var e=this.adsorbPoint,r=e.x,n=e.y,o=t.length;o?(t[o-1].x=r,t[o-1].y=n):(t.x=r,t.y=n)}else if(t){var i=t.geometry;if(i instanceof d.Circle){var a=i.getCoordinates(),s=this._map.getProjection().measureLength([a,this.adsorbPoint]);i.setRadius(s)}}},n.prototype._setEditCoordinates=function(t){if(this.adsorbPoint&&this._needDeal&&"MultiPolygon"!==this.geometry.type){var e=this.adsorbPoint,r=e.x,n=e.y;if(this.geometryCoords instanceof Array){var o=this.geometryCoords[0];if(!ce(o,this.adsorbPoint)){var i=t.getCoordinates(),a=i[0];if(a instanceof Array){var s=Mt(a,o,C);if(0===s.length)this._hasAddVertux=!0;else{var u=At(a,s[0]),c=a.length;i[0][u].x=r,i[0][u].y=n,0===u&&(i[0][c-1].x=r,i[0][c-1].y=n)}}else{var f=Mt(i,this.geometryCoords,C)[0],l=At(i,f);i[l].x=r,i[l].y=n}this._needDeal=!1,this._hasAddVertux||(this._upGeoCoords(i),t.setCoordinates(this.geometryCoords))}}else if(this.geometry instanceof d.Circle){this._needDeal=!1;var h=this.geometryCoords,p=this._map.getProjection().measureLength([h,this.adsorbPoint]);t.setRadius(p)}}},n.prototype._upGeoCoords=function(t){this.geometryCoords=t,this._hasAddVertux=!1},n}(d.Class);ke.mergeOptions(Le),t.Autoadsorb=ke,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.autoadsorb v0.1.0")});