/*!
 * maptalks.autoadsorb v0.1.0-beta.4
 * LICENSE : MIT
 * (c) 2016-2018 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,y){"use strict";var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t,e){return t(e={exports:{}},e.exports),e.exports}var s=n(function(t,e){t.exports=function(){function v(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function i(t,e){return t<e?-1:e<t?1:0}return function(t,e,r,n,o){!function t(e,r,n,o,i){for(;n<o;){if(600<o-n){var a=o-n+1,s=r-n+1,u=Math.log(a),c=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*c*(a-c)/a)*(s-a/2<0?-1:1),l=Math.max(n,Math.floor(r-s*c/a+f)),h=Math.min(o,Math.floor(r+(a-s)*c/a+f));t(e,r,l,h,i)}var p=e[r],d=n,y=o;for(v(e,n,r),0<i(e[o],p)&&v(e,n,o);d<y;){for(v(e,d,y),d++,y--;i(e[d],p)<0;)d++;for(;0<i(e[y],p);)y--}0===i(e[n],p)?v(e,n,y):v(e,++y,o),y<=r&&(n=y+1),r<=y&&(o=y-1)}}(t,e,r||0,n||t.length-1,o||i)}}()}),o=a,i=a;function a(t,e){if(!(this instanceof a))return new a(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function f(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}function p(t,e){m(t,0,t.children.length,e,t)}function m(t,e,r,n,o){o||(o=b(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(var i,a=e;a<r;a++)i=t.children[a],l(o,t.leaf?n(i):i);return o}function l(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function u(t,e){return t.minX-e.minX}function c(t,e){return t.minY-e.minY}function g(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function h(t){return t.maxX-t.minX+(t.maxY-t.minY)}function d(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function v(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function b(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _(t,e,r,n,o){for(var i,a=[e,r];a.length;)(r=a.pop())-(e=a.pop())<=n||(i=e+Math.ceil((r-e)/n/2)*n,s(t,i,e,r,o),a.push(e,i,i,r))}a.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],n=this.toBBox;if(!v(t,e))return r;for(var o,i,a,s,u=[];e;){for(o=0,i=e.children.length;o<i;o++)a=e.children[o],v(t,s=e.leaf?n(a):a)&&(e.leaf?r.push(a):d(t,s)?this._all(a,r):u.push(a));e=u.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!v(t,e))return!1;for(var n,o,i,a,s=[];e;){for(n=0,o=e.children.length;n<o;n++)if(i=e.children[n],v(t,a=e.leaf?r(i):i)){if(e.leaf||d(t,a))return!0;s.push(i)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var o=this.data;this.data=n,n=o}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=b([]),this},remove:function(t,e){if(!t)return this;for(var r,n,o,i,a=this.data,s=this.toBBox(t),u=[],c=[];a||u.length;){if(a||(a=u.pop(),n=u[u.length-1],r=c.pop(),i=!0),a.leaf&&-1!==(o=f(t,a.children,e)))return a.children.splice(o,1),u.push(a),this._condense(u),this;i||a.leaf||!d(a,s)?n?(r++,a=n.children[r],i=!1):a=null:(u.push(a),c.push(r),r=0,a=(n=a).children[0])}return this},toBBox:function(t){return t},compareMinX:u,compareMinY:c,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,n){var o,i=r-e+1,a=this._maxEntries;if(i<=a)return p(o=b(t.slice(e,r+1)),this.toBBox),o;n||(n=Math.ceil(Math.log(i)/Math.log(a)),a=Math.ceil(i/Math.pow(a,n-1))),(o=b([])).leaf=!1,o.height=n;var s,u,c,f,l=Math.ceil(i/a),h=l*Math.ceil(Math.sqrt(a));for(_(t,e,r,h,this.compareMinX),s=e;s<=r;s+=h)for(_(t,s,c=Math.min(s+h-1,r),l,this.compareMinY),u=s;u<=c;u+=l)f=Math.min(u+l-1,c),o.children.push(this._build(t,u,f,n-1));return p(o,this.toBBox),o},_chooseSubtree:function(t,e,r,n){for(var o,i,a,s,u,c,f,l,h,p;n.push(e),!e.leaf&&n.length-1!==r;){for(f=l=1/0,o=0,i=e.children.length;o<i;o++)u=g(a=e.children[o]),h=t,p=a,(c=(Math.max(p.maxX,h.maxX)-Math.min(p.minX,h.minX))*(Math.max(p.maxY,h.maxY)-Math.min(p.minY,h.minY))-u)<l?(l=c,f=u<f?u:f,s=a):c===l&&u<f&&(f=u,s=a);e=s||e.children[0]}return e},_insert:function(t,e,r){var n=this.toBBox,o=r?t:n(t),i=[],a=this._chooseSubtree(o,this.data,e,i);for(a.children.push(t),l(a,o);0<=e&&i[e].children.length>this._maxEntries;)this._split(i,e),e--;this._adjustParentBBoxes(o,i,e)},_split:function(t,e){var r=t[e],n=r.children.length,o=this._minEntries;this._chooseSplitAxis(r,o,n);var i=this._chooseSplitIndex(r,o,n),a=b(r.children.splice(i,r.children.length-i));a.height=r.height,a.leaf=r.leaf,p(r,this.toBBox),p(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(r,a)},_splitRoot:function(t,e){this.data=b([t,e]),this.data.height=t.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var n,o,i,a,s,u,c,f,l,h,p,d,y,v;for(u=c=1/0,n=e;n<=r-e;n++)o=m(t,0,n,this.toBBox),i=m(t,n,r,this.toBBox),l=o,h=i,void 0,p=Math.max(l.minX,h.minX),d=Math.max(l.minY,h.minY),y=Math.min(l.maxX,h.maxX),v=Math.min(l.maxY,h.maxY),a=Math.max(0,y-p)*Math.max(0,v-d),s=g(o)+g(i),a<u?(u=a,f=n,c=s<c?s:c):a===u&&s<c&&(c=s,f=n);return f},_chooseSplitAxis:function(t,e,r){var n=t.leaf?this.compareMinX:u,o=t.leaf?this.compareMinY:c;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,o)&&t.children.sort(n)},_allDistMargin:function(t,e,r,n){t.children.sort(n);var o,i,a=this.toBBox,s=m(t,0,e,a),u=m(t,r-e,r,a),c=h(s)+h(u);for(o=e;o<r-e;o++)i=t.children[o],l(s,t.leaf?a(i):i),c+=h(s);for(o=r-e-1;e<=o;o--)i=t.children[o],l(u,t.leaf?a(i):i),c+=h(u);return c},_adjustParentBBoxes:function(t,e,r){for(var n=r;0<=n;n--)l(e[n],t)},_condense:function(t){for(var e,r=t.length-1;0<=r;r--)0===t[r].children.length?0<r?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():p(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}},o.default=i;var w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S=n(function(t,i){function s(t,e,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function n(t,e,r){return void 0===r&&(r={}),s({type:"Point",coordinates:t},e,r)}function o(t,e,r){void 0===r&&(r={});for(var n=0,o=t;n<o.length;n++){var i=o[n];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<i[i.length-1].length;a++)if(i[i.length-1][a]!==i[0][a])throw new Error("First and last Position are not equivalent.")}return s({type:"Polygon",coordinates:t},e,r)}function a(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return s({type:"LineString",coordinates:t},e,r)}function u(t,e){void 0===e&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function c(t,e,r){return void 0===r&&(r={}),s({type:"MultiLineString",coordinates:t},e,r)}function f(t,e,r){return void 0===r&&(r={}),s({type:"MultiPoint",coordinates:t},e,r)}function l(t,e,r){return void 0===r&&(r={}),s({type:"MultiPolygon",coordinates:t},e,r)}function h(t,e){void 0===e&&(e="kilometers");var r=i.factors[e];if(!r)throw new Error(e+" units is invalid");return t*r}function p(t,e){void 0===e&&(e="kilometers");var r=i.factors[e];if(!r)throw new Error(e+" units is invalid");return t/r}function r(t){return 180*(t%(2*Math.PI))/Math.PI}function e(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)&&!/^\s*$/.test(t)}Object.defineProperty(i,"__esModule",{value:!0}),i.earthRadius=6371008.8,i.factors={centimeters:100*i.earthRadius,centimetres:100*i.earthRadius,degrees:i.earthRadius/111325,feet:3.28084*i.earthRadius,inches:39.37*i.earthRadius,kilometers:i.earthRadius/1e3,kilometres:i.earthRadius/1e3,meters:i.earthRadius,metres:i.earthRadius,miles:i.earthRadius/1609.344,millimeters:1e3*i.earthRadius,millimetres:1e3*i.earthRadius,nauticalmiles:i.earthRadius/1852,radians:1,yards:i.earthRadius/1.0936},i.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/i.earthRadius,yards:1/1.0936},i.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},i.feature=s,i.geometry=function(t,e,r){switch(void 0===r&&(r={}),t){case"Point":return n(e).geometry;case"LineString":return a(e).geometry;case"Polygon":return o(e).geometry;case"MultiPoint":return f(e).geometry;case"MultiLineString":return c(e).geometry;case"MultiPolygon":return l(e).geometry;default:throw new Error(t+" is invalid")}},i.point=n,i.points=function(t,e,r){return void 0===r&&(r={}),u(t.map(function(t){return n(t,e)}),r)},i.polygon=o,i.polygons=function(t,e,r){return void 0===r&&(r={}),u(t.map(function(t){return o(t,e)}),r)},i.lineString=a,i.lineStrings=function(t,e,r){return void 0===r&&(r={}),u(t.map(function(t){return a(t,e)}),r)},i.featureCollection=u,i.multiLineString=c,i.multiPoint=f,i.multiPolygon=l,i.geometryCollection=function(t,e,r){return void 0===r&&(r={}),s({type:"GeometryCollection",geometries:t},e,r)},i.round=function(t,e){if(void 0===e&&(e=0),e&&!(0<=e))throw new Error("precision must be a positive number");var r=Math.pow(10,e||0);return Math.round(t*r)/r},i.radiansToLength=h,i.lengthToRadians=p,i.lengthToDegrees=function(t,e){return r(p(t,e))},i.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},i.radiansToDegrees=r,i.degreesToRadians=function(t){return t%360*Math.PI/180},i.convertLength=function(t,e,r){if(void 0===e&&(e="kilometers"),void 0===r&&(r="kilometers"),!(0<=t))throw new Error("length must be a positive number");return h(p(t,e),r)},i.convertArea=function(t,e,r){if(void 0===e&&(e="meters"),void 0===r&&(r="kilometers"),!(0<=t))throw new Error("area must be a positive number");var n=i.areaFactors[e];if(!n)throw new Error("invalid original units");var o=i.areaFactors[r];if(!o)throw new Error("invalid final units");return t/n*o},i.isNumber=e,i.isObject=function(t){return!!t&&t.constructor===Object},i.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(t){if(!e(t))throw new Error("bbox must only contain numbers")})},i.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(void 0===t?"undefined":w(t)))throw new Error("id must be a number or a string")},i.radians2degrees=function(){throw new Error("method has been renamed to `radiansToDegrees`")},i.degrees2radians=function(){throw new Error("method has been renamed to `degreesToRadians`")},i.distanceToDegrees=function(){throw new Error("method has been renamed to `lengthToDegrees`")},i.distanceToRadians=function(){throw new Error("method has been renamed to `lengthToRadians`")},i.radiansToDistance=function(){throw new Error("method has been renamed to `radiansToLength`")},i.bearingToAngle=function(){throw new Error("method has been renamed to `bearingToAzimuth`")},i.convertDistance=function(){throw new Error("method has been renamed to `convertLength`")}});r(S);var x=n(function(t,e){function x(t,e,r){if(null!==t)for(var n,o,i,a,s,u,c,f,l=0,h=0,p=t.type,d="FeatureCollection"===p,y="Feature"===p,v=d?t.features.length:1,m=0;m<v;m++){s=(f=!!(c=d?t.features[m].geometry:y?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var g=0;g<s;g++){var b=0,_=0;if(null!==(a=f?c.geometries[g]:c)){u=a.coordinates;var w=a.type;switch(l=!r||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===e(u,h,m,b,_))return!1;h++,b++;break;case"LineString":case"MultiPoint":for(n=0;n<u.length;n++){if(!1===e(u[n],h,m,b,_))return!1;h++,"MultiPoint"===w&&b++}"LineString"===w&&b++;break;case"Polygon":case"MultiLineString":for(n=0;n<u.length;n++){for(o=0;o<u[n].length-l;o++){if(!1===e(u[n][o],h,m,b,_))return!1;h++}"MultiLineString"===w&&b++,"Polygon"===w&&_++}"Polygon"===w&&b++;break;case"MultiPolygon":for(n=0;n<u.length;n++){for(o=_=0;o<u[n].length;o++){for(i=0;i<u[n][o].length-l;i++){if(!1===e(u[n][o][i],h,m,b,_))return!1;h++}_++}b++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(!1===x(a.geometries[n],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function i(t,e){var r;switch(t.type){case"FeatureCollection":for(r=0;r<t.features.length&&!1!==e(t.features[r].properties,r);r++);break;case"Feature":e(t.properties,0)}}function a(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length&&!1!==e(t.features[r],r);r++);}function r(t,e){var r,n,o,i,a,s,u,c,f,l,h=0,p="FeatureCollection"===t.type,d="Feature"===t.type,y=p?t.features.length:1;for(r=0;r<y;r++){for(s=p?t.features[r].geometry:d?t.geometry:t,c=p?t.features[r].properties:d?t.properties:{},f=p?t.features[r].bbox:d?t.bbox:void 0,l=p?t.features[r].id:d?t.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,o=0;o<a;o++)if(null!==(i=u?s.geometries[o]:s))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(i,h,c,f,l))return!1;break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(!1===e(i.geometries[n],h,c,f,l))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,h,c,f,l))return!1;h++}}function s(t,c){r(t,function(t,e,r,n,o){var i,a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==c(S.feature(t,r,{bbox:n,id:o}),e,0)&&void 0}switch(a){case"MultiPoint":i="Point";break;case"MultiLineString":i="LineString";break;case"MultiPolygon":i="Polygon"}for(var s=0;s<t.coordinates.length;s++){var u={type:i,coordinates:t.coordinates[s]};if(!1===c(S.feature(u,r),e,s))return!1}})}function n(t,d){s(t,function(a,s,u){var c=0;if(a.geometry){var t=a.geometry.type;if("Point"!==t&&"MultiPoint"!==t){var f,l=0,h=0,p=0;return!1!==x(a,function(t,e,r,n,o){if(void 0===f||l<s||h<n||p<o)return f=t,l=s,h=n,p=o,void(c=0);var i=S.lineString([f,t],a.properties);if(!1===d(i,s,u,o,c))return!1;c++,f=t})&&void 0}}})}function u(t,a){if(!t)throw new Error("geojson is required");s(t,function(t,e,r){if(null!==t.geometry){var n=t.geometry.type,o=t.geometry.coordinates;switch(n){case"LineString":if(!1===a(t,e,r,0,0))return!1;break;case"Polygon":for(var i=0;i<o.length;i++)if(!1===a(S.lineString(o[i],t.properties),e,r,i))return!1}}})}Object.defineProperty(e,"__esModule",{value:!0}),e.coordEach=x,e.coordReduce=function(t,i,a,e){var s=a;return x(t,function(t,e,r,n,o){s=0===e&&void 0===a?t:i(s,t,e,r,n,o)},e),s},e.propEach=i,e.propReduce=function(t,r,n){var o=n;return i(t,function(t,e){o=0===e&&void 0===n?t:r(o,t,e)}),o},e.featureEach=a,e.featureReduce=function(t,r,n){var o=n;return a(t,function(t,e){o=0===e&&void 0===n?t:r(o,t,e)}),o},e.coordAll=function(t){var e=[];return x(t,function(t){e.push(t)}),e},e.geomEach=r,e.geomReduce=function(t,i,a){var s=a;return r(t,function(t,e,r,n,o){s=0===e&&void 0===a?t:i(s,t,e,r,n,o)}),s},e.flattenEach=s,e.flattenReduce=function(t,n,o){var i=o;return s(t,function(t,e,r){i=0===e&&0===r&&void 0===o?t:n(i,t,e,r)}),i},e.segmentEach=n,e.segmentReduce=function(t,i,a){var s=a,u=!1;return n(t,function(t,e,r,n,o){s=!1===u&&void 0===a?t:i(s,t,e,r,n,o),u=!0}),s},e.lineEach=u,e.lineReduce=function(t,o,i){var a=i;return u(t,function(t,e,r,n){a=0===e&&void 0===i?t:o(a,t,e,r,n)}),a},e.findSegment=function(t,e){if(e=e||{},!S.isObject(e))throw new Error("options is invalid");var r,n=e.featureIndex||0,o=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.segmentIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),s=s||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":s=s||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=u.length+a-1),S.lineString([u[a],u[a+1]],s,e);case"Polygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a-1),S.lineString([u[i][a],u[i][a+1]],s,e);case"MultiLineString":return o<0&&(o=u.length+o),a<0&&(a=u[o].length+a-1),S.lineString([u[o][a],u[o][a+1]],s,e);case"MultiPolygon":return o<0&&(o=u.length+o),i<0&&(i=u[o].length+i),a<0&&(a=u[o][i].length-a-1),S.lineString([u[o][i][a],u[o][i][a+1]],s,e)}throw new Error("geojson is invalid")},e.findPoint=function(t,e){if(e=e||{},!S.isObject(e))throw new Error("options is invalid");var r,n=e.featureIndex||0,o=e.multiFeatureIndex||0,i=e.geometryIndex||0,a=e.coordIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),s=s||t.features[n].properties,r=t.features[n].geometry;break;case"Feature":s=s||t.properties,r=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=t;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":return S.point(u,s,e);case"MultiPoint":return o<0&&(o=u.length+o),S.point(u[o],s,e);case"LineString":return a<0&&(a=u.length+a),S.point(u[a],s,e);case"Polygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a),S.point(u[i][a],s,e);case"MultiLineString":return o<0&&(o=u.length+o),a<0&&(a=u[o].length+a),S.point(u[o][a],s,e);case"MultiPolygon":return o<0&&(o=u.length+o),i<0&&(i=u[o].length+i),a<0&&(a=u[o][i].length-a),S.point(u[o][i][a],s,e)}throw new Error("geojson is invalid")}});r(x);var P=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=[1/0,1/0,-1/0,-1/0];return x.coordEach(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}});r(P);var j=P.default,M=x.featureEach,E=S.featureCollection;function O(t){var e=o(t);return e.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:j(t),o.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:j(t),e.push(t)}):M(t,function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:j(t),e.push(t)}),o.prototype.load.call(this,e)},e.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:j(t),o.prototype.remove.call(this,t,e)},e.clear=function(){return o.prototype.clear.call(this)},e.search=function(t){var e=o.prototype.search.call(this,this.toBBox(t));return E(e)},e.collides=function(t){return o.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=o.prototype.all.call(this);return E(t)},e.toJSON=function(){return o.prototype.toJSON.call(this)},e.fromJSON=function(t){return o.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=j(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=j(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}var C=O,A=O;C.default=A;var k=function(){this.__data__=[],this.size=0};var L=function(t,e){return t===e||t!=t&&e!=e};var T=function(t,e){for(var r=t.length;r--;)if(L(t[r][0],e))return r;return-1},B=Array.prototype.splice;var F=function(t){var e=this.__data__,r=T(e,t);return!(r<0||(r==e.length-1?e.pop():B.call(e,r,1),--this.size,0))};var G=function(t){var e=this.__data__,r=T(e,t);return r<0?void 0:e[r][1]};var R=function(t){return-1<T(this.__data__,t)};var X=function(t,e){var r=this.__data__,n=T(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function Y(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Y.prototype.clear=k,Y.prototype.delete=F,Y.prototype.get=G,Y.prototype.has=R,Y.prototype.set=X;var D=Y;var N=function(){this.__data__=new D,this.size=0};var z=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var I=function(t){return this.__data__.get(t)};var q=function(t){return this.__data__.has(t)},$="object"==("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)&&e&&e.Object===Object&&e,J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U="object"==("undefined"==typeof self?"undefined":J(self))&&self&&self.Object===Object&&self,V=$||U||Function("return this")(),W=V.Symbol,K=Object.prototype,H=K.hasOwnProperty,Q=K.toString,Z=W?W.toStringTag:void 0;var tt=function(t){var e=H.call(t,Z),r=t[Z];try{var n=!(t[Z]=void 0)}catch(t){}var o=Q.call(t);return n&&(e?t[Z]=r:delete t[Z]),o},et=Object.prototype.toString;var rt=function(t){return et.call(t)},nt=W?W.toStringTag:void 0;var ot=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":nt&&nt in Object(t)?tt(t):rt(t)},it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var at=function(t){var e=void 0===t?"undefined":it(t);return null!=t&&("object"==e||"function"==e)};var st,ut=function(t){if(!at(t))return!1;var e=ot(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},ct=V["__core-js_shared__"],ft=(st=/[^.]+$/.exec(ct&&ct.keys&&ct.keys.IE_PROTO||""))?"Symbol(src)_1."+st:"";var lt=function(t){return!!ft&&ft in t},ht=Function.prototype.toString;var pt=function(t){if(null!=t){try{return ht.call(t)}catch(t){}try{return t+""}catch(t){}}return""},dt=/^\[object .+?Constructor\]$/,yt=Function.prototype,vt=Object.prototype,mt=yt.toString,gt=vt.hasOwnProperty,bt=RegExp("^"+mt.call(gt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var _t=function(t){return!(!at(t)||lt(t))&&(ut(t)?bt:dt).test(pt(t))};var wt=function(t,e){return null==t?void 0:t[e]};var xt=function(t,e){var r=wt(t,e);return _t(r)?r:void 0},St=xt(V,"Map"),Pt=xt(Object,"create");var jt=function(){this.__data__=Pt?Pt(null):{},this.size=0};var Mt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Et=Object.prototype.hasOwnProperty;var Ot=function(t){var e=this.__data__;if(Pt){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return Et.call(e,t)?e[t]:void 0},Ct=Object.prototype.hasOwnProperty;var At=function(t){var e=this.__data__;return Pt?void 0!==e[t]:Ct.call(e,t)};var kt=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Pt&&void 0===e?"__lodash_hash_undefined__":e,this};function Lt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Lt.prototype.clear=jt,Lt.prototype.delete=Mt,Lt.prototype.get=Ot,Lt.prototype.has=At,Lt.prototype.set=kt;var Tt=Lt;var Bt=function(){this.size=0,this.__data__={hash:new Tt,map:new(St||D),string:new Tt}},Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var Gt=function(t){var e=void 0===t?"undefined":Ft(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Rt=function(t,e){var r=t.__data__;return Gt(e)?r["string"==typeof e?"string":"hash"]:r.map};var Xt=function(t){var e=Rt(this,t).delete(t);return this.size-=e?1:0,e};var Yt=function(t){return Rt(this,t).get(t)};var Dt=function(t){return Rt(this,t).has(t)};var Nt=function(t,e){var r=Rt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function zt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}zt.prototype.clear=Bt,zt.prototype.delete=Xt,zt.prototype.get=Yt,zt.prototype.has=Dt,zt.prototype.set=Nt;var It=zt;var qt=function(t,e){var r=this.__data__;if(r instanceof D){var n=r.__data__;if(!St||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new It(n)}return r.set(t,e),this.size=r.size,this};function $t(t){var e=this.__data__=new D(t);this.size=e.size}$t.prototype.clear=N,$t.prototype.delete=z,$t.prototype.get=I,$t.prototype.has=q,$t.prototype.set=qt;var Jt=$t;var Ut=function(t){return this.__data__.has(t)};function Vt(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new It;++e<r;)this.add(t[e])}Vt.prototype.add=Vt.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Vt.prototype.has=Ut;var Wt=Vt;var Kt=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1};var Ht=function(t,e){return t.has(e)};var Qt=function(t,e,r,n,o,i){var a=1&r,s=t.length,u=e.length;if(s!=u&&!(a&&s<u))return!1;var c=i.get(t);if(c&&i.get(e))return c==e;var f=-1,l=!0,h=2&r?new Wt:void 0;for(i.set(t,e),i.set(e,t);++f<s;){var p=t[f],d=e[f];if(n)var y=a?n(d,p,f,e,t,i):n(p,d,f,t,e,i);if(void 0!==y){if(y)continue;l=!1;break}if(h){if(!Kt(e,function(t,e){if(!Ht(h,e)&&(p===t||o(p,t,r,n,i)))return h.push(e)})){l=!1;break}}else if(p!==d&&!o(p,d,r,n,i)){l=!1;break}}return i.delete(t),i.delete(e),l},Zt=V.Uint8Array;var te=function(t){var r=-1,n=Array(t.size);return t.forEach(function(t,e){n[++r]=[e,t]}),n};var ee=function(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r},re=W?W.prototype:void 0,ne=re?re.valueOf:void 0;var oe=function(t,e,r,n,o,i,a){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new Zt(t),new Zt(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return L(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var s=te;case"[object Set]":var u=1&n;if(s||(s=ee),t.size!=e.size&&!u)return!1;var c=a.get(t);if(c)return c==e;n|=2,a.set(t,e);var f=Qt(s(t),s(e),n,o,i,a);return a.delete(t),f;case"[object Symbol]":if(ne)return ne.call(t)==ne.call(e)}return!1};var ie=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t},ae=Array.isArray;var se=function(t,e,r){var n=e(t);return ae(t)?n:ie(n,r(t))};var ue=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var a=t[r];e(a,r,t)&&(i[o++]=a)}return i};var ce=function(){return[]},fe=Object.prototype.propertyIsEnumerable,le=Object.getOwnPropertySymbols,he=le?function(e){return null==e?[]:(e=Object(e),ue(le(e),function(t){return fe.call(e,t)}))}:ce;var pe=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n},de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var ye=function(t){return null!=t&&"object"==(void 0===t?"undefined":de(t))};var ve=function(t){return ye(t)&&"[object Arguments]"==ot(t)},me=Object.prototype,ge=me.hasOwnProperty,be=me.propertyIsEnumerable,_e=ve(function(){return arguments}())?ve:function(t){return ye(t)&&ge.call(t,"callee")&&!be.call(t,"callee")};var we=function(){return!1},xe=n(function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?V.Buffer:void 0,i=(o?o.isBuffer:void 0)||we;t.exports=i}),Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pe=/^(?:0|[1-9]\d*)$/;var je=function(t,e){var r=void 0===t?"undefined":Se(t);return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&Pe.test(t))&&-1<t&&t%1==0&&t<e};var Me=function(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=9007199254740991},Ee={};Ee["[object Float32Array]"]=Ee["[object Float64Array]"]=Ee["[object Int8Array]"]=Ee["[object Int16Array]"]=Ee["[object Int32Array]"]=Ee["[object Uint8Array]"]=Ee["[object Uint8ClampedArray]"]=Ee["[object Uint16Array]"]=Ee["[object Uint32Array]"]=!0,Ee["[object Arguments]"]=Ee["[object Array]"]=Ee["[object ArrayBuffer]"]=Ee["[object Boolean]"]=Ee["[object DataView]"]=Ee["[object Date]"]=Ee["[object Error]"]=Ee["[object Function]"]=Ee["[object Map]"]=Ee["[object Number]"]=Ee["[object Object]"]=Ee["[object RegExp]"]=Ee["[object Set]"]=Ee["[object String]"]=Ee["[object WeakMap]"]=!1;var Oe=function(t){return ye(t)&&Me(t.length)&&!!Ee[ot(t)]};var Ce=function(e){return function(t){return e(t)}},Ae=n(function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r&&$.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i}),ke=Ae&&Ae.isTypedArray,Le=ke?Ce(ke):Oe,Te=Object.prototype.hasOwnProperty;var Be=function(t,e){var r=ae(t),n=!r&&_e(t),o=!r&&!n&&xe(t),i=!r&&!n&&!o&&Le(t),a=r||n||o||i,s=a?pe(t.length,String):[],u=s.length;for(var c in t)!e&&!Te.call(t,c)||a&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||je(c,u))||s.push(c);return s},Fe=Object.prototype;var Ge=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Fe)};var Re=function(e,r){return function(t){return e(r(t))}}(Object.keys,Object),Xe=Object.prototype.hasOwnProperty;var Ye=function(t){if(!Ge(t))return Re(t);var e=[];for(var r in Object(t))Xe.call(t,r)&&"constructor"!=r&&e.push(r);return e};var De=function(t){return null!=t&&Me(t.length)&&!ut(t)};var Ne=function(t){return De(t)?Be(t):Ye(t)};var ze=function(t){return se(t,Ne,he)},Ie=Object.prototype.hasOwnProperty;var qe=function(t,e,r,n,o,i){var a=1&r,s=ze(t),u=s.length;if(u!=ze(e).length&&!a)return!1;for(var c=u;c--;){var f=s[c];if(!(a?f in e:Ie.call(e,f)))return!1}var l=i.get(t);if(l&&i.get(e))return l==e;var h=!0;i.set(t,e),i.set(e,t);for(var p=a;++c<u;){var d=t[f=s[c]],y=e[f];if(n)var v=a?n(y,d,f,e,t,i):n(d,y,f,t,e,i);if(!(void 0===v?d===y||o(d,y,r,n,i):v)){h=!1;break}p||(p="constructor"==f)}if(h&&!p){var m=t.constructor,g=e.constructor;m!=g&&"constructor"in t&&"constructor"in e&&!("function"==typeof m&&m instanceof m&&"function"==typeof g&&g instanceof g)&&(h=!1)}return i.delete(t),i.delete(e),h},$e=xt(V,"DataView"),Je=xt(V,"Promise"),Ue=xt(V,"Set"),Ve=xt(V,"WeakMap"),We="[object Map]",Ke="[object Promise]",He="[object Set]",Qe="[object WeakMap]",Ze="[object DataView]",tr=pt($e),er=pt(St),rr=pt(Je),nr=pt(Ue),or=pt(Ve),ir=ot;($e&&ir(new $e(new ArrayBuffer(1)))!=Ze||St&&ir(new St)!=We||Je&&ir(Je.resolve())!=Ke||Ue&&ir(new Ue)!=He||Ve&&ir(new Ve)!=Qe)&&(ir=function(t){var e=ot(t),r="[object Object]"==e?t.constructor:void 0,n=r?pt(r):"";if(n)switch(n){case tr:return Ze;case er:return We;case rr:return Ke;case nr:return He;case or:return Qe}return e});var ar=ir,sr="[object Arguments]",ur="[object Array]",cr="[object Object]",fr=Object.prototype.hasOwnProperty;var lr=function(t,e,r,n,o,i){var a=ae(t),s=ae(e),u=a?ur:ar(t),c=s?ur:ar(e),f=(u=u==sr?cr:u)==cr,l=(c=c==sr?cr:c)==cr,h=u==c;if(h&&xe(t)){if(!xe(e))return!1;f=!(a=!0)}if(h&&!f)return i||(i=new Jt),a||Le(t)?Qt(t,e,r,n,o,i):oe(t,e,u,r,n,o,i);if(!(1&r)){var p=f&&fr.call(t,"__wrapped__"),d=l&&fr.call(e,"__wrapped__");if(p||d){var y=p?t.value():t,v=d?e.value():e;return i||(i=new Jt),o(y,v,r,n,i)}}return!!h&&(i||(i=new Jt),qe(t,e,r,n,o,i))};var hr=function t(e,r,n,o,i){return e===r||(null==e||null==r||!ye(e)&&!ye(r)?e!=e&&r!=r:lr(e,r,n,o,t,i))};var pr=function(t,e){return hr(t,e)};var dr=function(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1};var yr=function(t){return t!=t};var vr=function(t,e,r){for(var n=r-1,o=t.length;++n<o;)if(t[n]===e)return n;return-1};var mr=function(t,e,r){return e==e?vr(t,e,r):dr(t,yr,r)};var gr=function(t,e){return!(null==t||!t.length)&&-1<mr(t,e,0)};var br=function(t,e,r){for(var n=-1,o=null==t?0:t.length;++n<o;)if(r(e,t[n]))return!0;return!1};var _r=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o};var wr=function(t,e,r,n){var o=-1,i=gr,a=!0,s=t.length,u=[],c=e.length;if(!s)return u;r&&(e=_r(e,Ce(r))),n?(i=br,a=!1):200<=e.length&&(i=Ht,a=!1,e=new Wt(e));t:for(;++o<s;){var f=t[o],l=null==r?f:r(f);if(f=n||0!==f?f:0,a&&l==l){for(var h=c;h--;)if(e[h]===l)continue t;u.push(f)}else i(e,l,n)||u.push(f)}return u},xr=W?W.isConcatSpreadable:void 0;var Sr=function(t){return ae(t)||_e(t)||!!(xr&&t&&t[xr])};var Pr=function t(e,r,n,o,i){var a=-1,s=e.length;for(n||(n=Sr),i||(i=[]);++a<s;){var u=e[a];0<r&&n(u)?1<r?t(u,r-1,n,o,i):ie(i,u):o||(i[i.length]=u)}return i};var jr=function(t){return t};var Mr=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)},Er=Math.max;var Or=function(i,a,s){return a=Er(void 0===a?i.length-1:a,0),function(){for(var t=arguments,e=-1,r=Er(t.length-a,0),n=Array(r);++e<r;)n[e]=t[a+e];e=-1;for(var o=Array(a+1);++e<a;)o[e]=t[e];return o[a]=s(n),Mr(i,this,o)}};var Cr=function(t){return function(){return t}},Ar=function(){try{var t=xt(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),kr=Ar?function(t,e){return Ar(t,"toString",{configurable:!0,enumerable:!1,value:Cr(e),writable:!0})}:jr,Lr=Date.now;var Tr=function(r){var n=0,o=0;return function(){var t=Lr(),e=16-(t-o);if(o=t,0<e){if(800<=++n)return arguments[0]}else n=0;return r.apply(void 0,arguments)}}(kr);var Br=function(t){return ye(t)&&De(t)};var Fr=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0},Gr=function(t,e){return Tr(Or(t,e,jr),t+"")}(function(t,e){var r=Fr(e);return Br(r)&&(r=void 0),Br(t)?wr(t,Pr(e,1,Br,!0),void 0,r):[]});var Rr=function(t,e,r,n){var o=r.length,i=o,a=!n;if(null==t)return!i;for(t=Object(t);o--;){var s=r[o];if(a&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++o<i;){var u=(s=r[o])[0],c=t[u],f=s[1];if(a&&s[2]){if(void 0===c&&!(u in t))return!1}else{var l=new Jt;if(n)var h=n(c,f,u,t,e,l);if(!(void 0===h?hr(f,c,3,n,l):h))return!1}}return!0};var Xr=function(t){return t==t&&!at(t)};var Yr=function(t){for(var e=Ne(t),r=e.length;r--;){var n=e[r],o=t[n];e[r]=[n,o,Xr(o)]}return e};var Dr=function(e,r){return function(t){return null!=t&&t[e]===r&&(void 0!==r||e in Object(t))}};var Nr=function(e){var r=Yr(e);return 1==r.length&&r[0][2]?Dr(r[0][0],r[0][1]):function(t){return t===e||Rr(t,e,r)}},zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var Ir=function(t){return"symbol"==(void 0===t?"undefined":zr(t))||ye(t)&&"[object Symbol]"==ot(t)},qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Jr=/^\w*$/;var Ur=function(t,e){if(ae(t))return!1;var r=void 0===t?"undefined":qr(t);return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!Ir(t))||Jr.test(t)||!$r.test(t)||null!=e&&t in Object(e)},Vr="Expected a function";function Wr(i,a){if("function"!=typeof i||null!=a&&"function"!=typeof a)throw new TypeError(Vr);var t=function t(){var e=arguments,r=a?a.apply(this,e):e[0],n=t.cache;if(n.has(r))return n.get(r);var o=i.apply(this,e);return t.cache=n.set(r,o)||n,o};return t.cache=new(Wr.Cache||It),t}Wr.Cache=It;var Kr=Wr;var Hr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Qr=/\\(\\)?/g,Zr=function(t){var e=Kr(t,function(t){return 500===r.size&&r.clear(),t}),r=e.cache;return e}(function(t){var o=[];return 46===t.charCodeAt(0)&&o.push(""),t.replace(Hr,function(t,e,r,n){o.push(r?n.replace(Qr,"$1"):e||t)}),o}),tn=1/0,en=W?W.prototype:void 0,rn=en?en.toString:void 0;var nn=function t(e){if("string"==typeof e)return e;if(ae(e))return _r(e,t)+"";if(Ir(e))return rn?rn.call(e):"";var r=e+"";return"0"==r&&1/e==-tn?"-0":r};var on=function(t){return null==t?"":nn(t)};var an=function(t,e){return ae(t)?t:Ur(t,e)?[t]:Zr(on(t))};var sn=function(t){if("string"==typeof t||Ir(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e};var un=function(t,e){for(var r=0,n=(e=an(e,t)).length;null!=t&&r<n;)t=t[sn(e[r++])];return r&&r==n?t:void 0};var cn=function(t,e,r){var n=null==t?void 0:un(t,e);return void 0===n?r:n};var fn=function(t,e){return null!=t&&e in Object(t)};var ln=function(t,e,r){for(var n=-1,o=(e=an(e,t)).length,i=!1;++n<o;){var a=sn(e[n]);if(!(i=null!=t&&r(t,a)))break;t=t[a]}return i||++n!=o?i:!!(o=null==t?0:t.length)&&Me(o)&&je(a,o)&&(ae(t)||_e(t))};var hn=function(t,e){return null!=t&&ln(t,e,fn)};var pn=function(r,n){return Ur(r)&&Xr(n)?Dr(sn(r),n):function(t){var e=cn(t,r);return void 0===e&&e===n?hn(t,r):hr(n,e,3)}};var dn=function(e){return function(t){return null==t?void 0:t[e]}};var yn=function(e){return function(t){return un(t,e)}};var vn=function(t){return Ur(t)?dn(sn(t)):yn(t)},mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var gn=function(t){return"function"==typeof t?t:null==t?jr:"object"==(void 0===t?"undefined":mn(t))?ae(t)?pn(t[0],t[1]):Nr(t):vn(t)},bn=/^\s+|\s+$/g,_n=/^[-+]0x[0-9a-f]+$/i,wn=/^0b[01]+$/i,xn=/^0o[0-7]+$/i,Sn=parseInt;var Pn=function(t){if("number"==typeof t)return t;if(Ir(t))return NaN;if(at(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=at(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(bn,"");var r=wn.test(t);return r||xn.test(t)?Sn(t.slice(2),r?2:8):_n.test(t)?NaN:+t};var jn=function(t){return t?(t=Pn(t))===1/0||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var Mn=function(t){var e=jn(t),r=e%1;return e==e?r?e-r:e:0},En=Math.max;var On=function(t,e,r){var n=null==t?0:t.length;if(!n)return-1;var o=null==r?0:Mn(r);return o<0&&(o=En(n+o,0)),dr(t,gn(e,3),o)};var Cn=function(t){return"string"==typeof t||!ae(t)&&ye(t)&&"[object String]"==ot(t)};var An=function(e,t){return _r(t,function(t){return e[t]})};var kn=function(t){return null==t?[]:An(t,Ne(t))},Ln=Math.max;var Tn=function(t,e,r,n){t=De(t)?t:kn(t),r=r&&!n?Mn(r):0;var o=t.length;return r<0&&(r=Ln(o+r,0)),Cn(t)?r<=o&&-1<t.indexOf(e,r):!!o&&-1<mr(t,e,r)};var Bn=function(t){return null!=t&&t.length?Pr(t,1/0):[]};function Fn(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++){var o=r[n],i=Object.getOwnPropertyDescriptor(e,o);i&&i.configurable&&void 0===t[o]&&Object.defineProperty(t,o,i)}}(t,e))}var Gn={mode:"auto",distance:10,needCtrl:!1},Rn=function(r){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,r.call(this,t));return e.tree=C(),e._layerName=y.INTERNAL_LAYER_PREFIX+"_Autoadsorb",e._isEnable=!1,e._updateModeType(t&&t.mode),e._updateDistance(t&&t.distance),e._updateNeedCtrl(t&&t.needCtrl),e}return Fn(n,r),n.prototype.setLayer=function(t){var e=this;if(t instanceof y.VectorLayer){var r=t.map;this._addTo(r),this.adsorblayer=t,this.adsorblayer.on("addgeo",function(){return e._updateGeosSet()},this),this.adsorblayer.on("clear",function(){return e._resetGeosSet()},this),this.bindDrawTool(r._map_tool)}return this},n.prototype.bindDrawTool=function(t){var e=this;return t instanceof y.DrawTool&&((this.drawTool=t).on("enable",function(t){return e.enable()},this),t.on("disable",function(t){return e.disable()},this),t.on("remove",function(t){return e.remove()},this),t.isEnabled()&&this.enable()),this},n.prototype.setGeometry=function(t){if(t instanceof y.Geometry){var e=t._layer,r=e.map;this._addTo(r),this.adsorblayer=e,this.bindGeometry(t)}return this},n.prototype.bindGeometry=function(t){var e=this;if(t instanceof y.Geometry){if(this.geometry)return this.setGeometry(t);this.geometry=t,this.geometryCoords=t.getCoordinates(),t.on("editstart",function(t){return e.enable()},this),t.on("editend",function(t){return e.disable()},this),t.on("remove",function(t){return e.remove()},this),t.isEditing()?(t.endEdit(),this.enable(),t.startEdit()):t.startEdit().endEdit()}return this},n.prototype.enable=function(){return this._isEnable=!0,this._updateGeosSet(),this._registerMapEvents(),this.drawTool&&this._registerDrawToolEvents(),this.geometry&&this._registerGeometryEvents(),this._mousemoveLayer&&this._mousemoveLayer.show(),this},n.prototype.disable=function(){return this._isEnable=!1,this._offMapEvents(),this._offDrawToolEvents(),this._offGeometryEvents(),this._resetGeosSet(),delete this._mousemove,delete this._mousedown,delete this._mouseup,this._mousemoveLayer&&this._mousemoveLayer.hide(),this},n.prototype.isEnable=function(){return this._isEnable},n.prototype.toggleable=function(){this._isEnable?this.disable():this.enable()},n.prototype.remove=function(){this.disable();var t=map.getLayer(this._layerName);t&&t.remove(),delete this.geometry,delete this.geometryCoords,delete this._mousemoveLayer},n.prototype.setMode=function(t){return this._updateModeType(t),this._updateGeosSet(),this},n.prototype.getMode=function(){return this._mode},n.prototype.setDistance=function(t){return this._updateDistance(t),this._updateGeosSet(),this},n.prototype.getDistance=function(){return this._distance},n.prototype.needCtrl=function(t){this._updateNeedCtrl(t)},n.prototype._updateModeType=function(t){this._mode=t||this.options.mode||Gn.mode},n.prototype._updateDistance=function(t){t=t||this.options.distance||Gn.distance,this._distance=Math.max(t,1)},n.prototype._updateNeedCtrl=function(t){t=void 0!==(t=void 0!==t?t:this.options.needCtrl)?t:Gn.needCtrl,this._needCtrl=t},n.prototype._addTo=function(t){return t.getLayer(this._layerName)&&this.remove(),this._mousemoveLayer=new y.VectorLayer(this._layerName).addTo(t),this._mousemoveLayer.bringToFront(),this._map=t,this._resetGeosSet(),this},n.prototype._updateGeosSet=function(){var e=this,t=this.adsorblayer.getGeometries(),r="auto"===this._mode,n="vertux"===this._mode,o="border"===this._mode,i=[],a=[];t.forEach(function(t){((r||n)&&i.push.apply(i,e._parseToPoints(t)),r||o)&&e._parseToLines(t).forEach(function(t){"Point"===t.geometry.type?i.push(t):a.push(t)})}),this._geosSetPoint=i,this._geosSetLine=a},n.prototype._parseToPoints=function(t){var e=this;if(this._skipGeoSelf(t))return[];var r=[],n=t.getCoordinates();return n[0]instanceof Array?n.forEach(function(t){return r.push.apply(r,e._createMarkers(t))}):(n instanceof Array||(n=[n]),r.push.apply(r,this._createMarkers(n))),r},n.prototype._skipGeoSelf=function(t){if(this.geometry){var e=t.toGeoJSON().geometry.coordinates,r=this.geometry.toGeoJSON().geometry.coordinates;return pr(e,r)}return!1},n.prototype._createMarkers=function(t){var e=[];return Bn(t).forEach(function(t){return e.push(new y.Marker(t,{properties:{}}).toGeoJSON())}),e},n.prototype._parseToLines=function(t){if(this._skipGeoSelf(t))return[];var e=[];return"Point"===t.type?e.push(t.setProperties({}).toGeoJSON()):e.push.apply(e,this._parsePolygonToLine(t)),e},n.prototype._parsePolygonToLine=function(e){var r=this,t=e.getCoordinates(),n=[];if(t instanceof Array)switch(e.type){case"MultiPolygon":t.forEach(function(t){return t.forEach(function(t){return n.push.apply(n,r._createLine(t,e))})});break;case"Polygon":t.forEach(function(t){return n.push.apply(n,r._createLine(t,e))});break;default:n.push.apply(n,this._createLine(t,e))}else if("Polygon"===e.type){var o=e.options;o.numberOfShellPoints=300,e.setOptions(o),t=e.getShell(),o.numberOfShellPoints=60,e.setOptions(o),n.push.apply(n,this._createMarkers(t))}return n},n.prototype._createLine=function(t,e){for(var r=[],n=0;n<t.length-1;n++){var o=t[n],i=t[n+1],a=new y.LineString([o,i],{properties:{obj:e}});r.push(a.toGeoJSON())}return r},n.prototype._resetGeosSet=function(){this._geosSetPoint=[],this._geosSetLine=[]},n.prototype._registerMapEvents=function(){var e=this;if(!this._mousemove){var t=this._map;this._mousemove=function(t){return e._mousemoveEvents(t)},this._mousedown=function(){e.drawTool&&(e._needFindGeometry=!1),e.geometry&&(e._needFindGeometry=!0)},this._mouseup=function(){e.drawTool&&(e._needFindGeometry=!0),e.geometry&&(e._needFindGeometry=!1)},t.on("mousemove touchstart",this._mousemove,this),t.on("mousedown",this._mousedown,this),t.on("mouseup",this._mouseup,this)}},n.prototype._offMapEvents=function(){var t=this._map;this._mousemove&&t.off("mousemove touchstart",this._mousemove,this),this._mousedown&&t.off("mousedown",this._mousedown,this),this._mouseup&&t.off("mouseup",this._mouseup,this)},n.prototype._mousemoveEvents=function(t){var e=t.coordinate,r=t.domEvent.ctrlKey;this._needDeal=!0,this._mousePoint=e,this._marker?this._marker.setCoordinates(e):this._marker=new y.Marker(e,{symbol:{}}).addTo(this._mousemoveLayer),this._updateAdsorbPoint(e),this._needCtrl!==r&&(this.adsorbPoint=null)},n.prototype._updateAdsorbPoint=function(t){if(this._needFindGeometry){var e=this._findGeometry(t);if(this.adsorbPoint=e&&0<e.features.length?this._getAdsorbPoint(e):null,this.adsorbPoint){var r=this.adsorbPoint,n=r.x,o=r.y;this._marker.setCoordinates([n,o])}}},n.prototype._findGeometry=function(t){if(!this._geosSetPoint&&!this._geosSetLine)return null;var e={type:"FeatureCollection",features:[]};if(this._geosSetPoint){var r,n=this._findAvailGeos(this._geosSetPoint,t);(r=e.features).push.apply(r,n)}if(this._geosSetLine){var o,i=this._findAvailGeos(this._geosSetLine,t);(o=e.features).push.apply(o,i)}return e},n.prototype._findAvailGeos=function(t,e){this.tree.clear(),this.tree.load({type:"FeatureCollection",features:t});var r=this._createInspectExtent(e);return this.tree.search(r).features},n.prototype._createInspectExtent=function(t){var e=Math.max(parseInt(this._distance,0),1),r=this._map.pixelToDistance(0,e);return new y.Circle(t,r,{properties:{}}).toGeoJSON()},n.prototype._getAdsorbPoint=function(t){var e=this._findNearestFeatures(t.features);if(!e)return null;var r=e.geoObject,n=r.geometry,o=n.coordinates,i=n.type,a=o[0];switch(i){case"Point":return{x:a,y:o[1]};case"LineString":var s=this._setEquation(r),u=s.A,c=s.B,f=this._mousePoint,l=f.x,h=f.y;if(0===u)return{x:l,y:a[1]};if(u===1/0)return{x:a[0],y:h};var p=c/u,d=this._setVertiEquation(p);return this._solveEquation(s,d);default:return null}},n.prototype._findNearestFeatures=function(t){var e=this._setDistance(t);return 0===e.length?null:(e=e.sort(this._compare(e,"distance")))[0]},n.prototype._setDistance=function(t){var e=[],r=!0;t.forEach(function(t){var e=t.geometry.type;r=r&&"Point"!==e});for(var n=0;n<t.length;n++){var o=t[n],i=void 0;switch(o.geometry.type){case"Point":i=this._distToPoint(o);break;case"LineString":r&&(i=this._distToPolyline(o))}void 0!==i&&e.push({geoObject:o,distance:i})}return e},n.prototype._distToPoint=function(t){var e=this._mousePoint,r=[e.x,e.y],n=t.geometry.coordinates;return Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2))},n.prototype._distToPolyline=function(t){var e=this._mousePoint,r=e.x,n=e.y,o=this._setEquation(t),i=o.A,a=o.B,s=o.C;return Math.abs((i*r+a*n+s)/Math.sqrt(Math.pow(i,2)+Math.pow(a,2)))},n.prototype._compare=function(t,n){return function(t,e){var r=t[n];return e[n]<r}},n.prototype._setEquation=function(t){var e=t.geometry.coordinates,r=e[0],n=e[1],o=r[0],i=r[1],a=n[0],s=(i-n[1])/(o-a);return{A:s=s===-1/0?-s:s,B:-1,C:i-s*o}},n.prototype._setVertiEquation=function(t){var e=this._mousePoint,r=e.x;return{A:t,B:-1,C:e.y-t*r}},n.prototype._solveEquation=function(t,e){var r=t.A,n=t.B,o=t.C,i=e.A,a=e.B,s=e.C;return{x:(n*s-o*a)/(r*a-i*n),y:(r*s-i*o)/(n*i-a*r)}},n.prototype._registerDrawToolEvents=function(){var e=this,t=this.drawTool;t.on("drawstart",function(t){return e._resetCoordsAndPoint(t)},this),t.on("mousemove",function(t){return e._resetCoordinates(t.target._geometry||t)},this),t.on("drawvertex",function(t){return e._resetCoordsAndPoint(t)},this),t.on("drawend",function(t){return e._resetCoordinates(t.geometry||t)},this)},n.prototype._offDrawToolEvents=function(){var e=this;if(this.drawTool){var t=this.drawTool;t.off("drawstart",function(t){return e._resetCoordsAndPoint},this),t.off("mousemove",function(t){return e._resetCoordinates},this),t.off("drawvertex",function(t){return e._resetCoordsAndPoint},this),t.off("drawend",function(t){return e._resetCoordinates},this)}},n.prototype._registerGeometryEvents=function(){var e=this,t=this.geometry;t.on("shapechange",function(t){return e._setEditCoordinates(t.target)},this),t.on("editrecord",function(t){return e._upGeoCoords(t.target.getCoordinates())},this)},n.prototype._offGeometryEvents=function(){var e=this;if(this.geometry){var t=this.geometry;t.off("shapechange",function(t){return e._setEditCoordinates},this),t.off("editrecord",function(t){return e._upGeoCoords},this)}},n.prototype._resetCoordsAndPoint=function(t){this._resetCoordinates(t.target._geometry||t),this._resetClickPoint(t.target._clickCoords)},n.prototype._resetCoordinates=function(t){if(this.adsorbPoint){var e=this.adsorbPoint,r=e.x,n=e.y;if(t instanceof y.Geometry){var o=t.getCoordinates();if(o instanceof Array){var i=o.length;i&&(o[i-1].x=r,o[i-1].y=n),t.setCoordinates(o)}else if(t instanceof y.Circle){var a=this._map.getProjection().measureLength([o,this.adsorbPoint]);t.setRadius(a)}}}},n.prototype._resetClickPoint=function(t){if(this.adsorbPoint)if(t instanceof y.Coordinate||t instanceof Array){var e=this.adsorbPoint,r=e.x,n=e.y,o=t.length;o?(t[o-1].x=r,t[o-1].y=n):(t.x=r,t.y=n)}else if(t){var i=t.geometry;if(i instanceof y.Circle){var a=this._map,s=i.getCoordinates(),u=a.getProjection().measureLength([s,this.adsorbPoint]);i.setRadius(u)}}},n.prototype._setEditCoordinates=function(t){if(this.adsorbPoint&&this._needDeal&&"MultiPolygon"!==this.geometry.type){var e=this.adsorbPoint,r=e.x,n=e.y;if(this.geometryCoords instanceof Array){var o=this.geometryCoords[0];if(!Tn(o,this.adsorbPoint)){var i=t.getCoordinates(),a=i[0];if(a instanceof Array){var s=Gr(a,o,pr)[0],u=On(a,s),c=a.length;i[0][u].x=r,i[0][u].y=n,0===u&&(i[0][c-1].x=r,i[0][c-1].y=n)}else{var f=Gr(i,this.geometryCoords,pr)[0],l=On(i,f);i[l].x=r,i[l].y=n}this._needDeal=!1,this._upGeoCoords(i),t.setCoordinates(this.geometryCoords)}}else if(this.geometry instanceof y.Circle){this._needDeal=!1;var h=this._map,p=this.geometryCoords,d=h.getProjection().measureLength([p,this.adsorbPoint]);t.setRadius(d)}}},n.prototype._upGeoCoords=function(t){this.geometryCoords=t},n}(y.Class);Rn.mergeOptions(Gn),t.Autoadsorb=Rn,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.autoadsorb v0.1.0-beta.4")});